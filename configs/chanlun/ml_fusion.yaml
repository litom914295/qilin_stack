# 缠论增强LightGBM模型配置
# 
# 深度集成缠论因子和Alpha因子到ML模型
#
# 作者: Warp AI Assistant
# 日期: 2025-01
# 项目: 麒麟量化系统 - Phase 4.2

# ================== Qlib初始化 ==================
qlib_init:
  provider_uri: "~/.qlib/qlib_data/cn_data"
  region: cn

market: csi300

# ================== 数据Handler ==================
data_handler_config: &data_handler_config
  start_time: 2020-01-01
  end_time: 2023-12-31
  fit_start_time: 2020-01-01
  fit_end_time: 2022-12-31
  instruments: csi300
  
  # 使用缠论因子Handler
  class: ChanLunFactorHandler
  module_path: qlib_enhanced.chanlun.factor_handler
  kwargs:
    use_czsc: true
    use_chanpy: true
    drop_raw: false
  
  # 数据处理器
  infer_processors:
    - class: RobustZScoreNorm
      kwargs:
        fields_group: feature
        clip_outlier: true
    - class: Fillna
      kwargs:
        fields_group: feature
  
  learn_processors:
    - class: DropnaLabel
    - class: CSRankNorm
      kwargs:
        fields_group: label

# ================== 模型配置 ==================
model:
  class: ChanLunEnhancedLGBModel
  module_path: ml.chanlun_enhanced_model
  kwargs:
    # 缠论增强参数
    use_chanlun: true
    chanlun_weight: 0.3
    use_alpha: true
    alpha_only_top5: false
    enable_feature_analysis: true
    
    # LightGBM参数
    loss: mse
    num_boost_round: 500
    early_stopping_rounds: 50
    learning_rate: 0.05
    max_depth: 8
    num_leaves: 210
    colsample_bytree: 0.8
    subsample: 0.8
    lambda_l1: 205.6999
    lambda_l2: 580.9768
    min_child_weight: 1
    num_threads: 20
    verbosity: -1

# ================== 策略配置 ==================
strategy:
  class: TopkDropoutStrategy
  module_path: qlib.contrib.strategy.signal_strategy
  kwargs:
    signal:
      - <MODEL>
      - <DATASET>
    topk: 30
    n_drop: 5
    method_sell: bottom
    method_buy: top

# ================== 回测配置 ==================
backtest:
  start_time: 2022-01-01
  end_time: 2023-12-31
  account: 100000000
  benchmark: SH000300
  exchange_kwargs:
    freq: day
    limit_threshold: 0.095
    deal_price: close
    open_cost: 0.0005
    close_cost: 0.0015
    min_cost: 5

# ================== 使用场景 ==================
use_cases:
  # 完整ML流程
  full_ml_workflow:
    description: "完整的ML训练和回测流程"
    command: "qrun run --config_path configs/chanlun/ml_fusion.yaml"
    features:
      - 16个基础缠论因子
      - 10个Alpha因子
      - Qlib原生因子（可选）
      - 技术指标（可选）
  
  # 仅使用Top5 Alpha因子（快速模式）
  quick_mode:
    description: "仅使用Top5重要Alpha因子"
    modifications:
      model.kwargs.alpha_only_top5: true
      model.kwargs.num_boost_round: 200
    expected_speedup: "2x"
  
  # 特征重要性分析
  feature_analysis:
    description: "训练后分析特征重要性"
    post_training:
      - model.get_chanlun_feature_importance()
      - model.get_alpha_feature_importance()
      - model.plot_importance(save_path='output/importance.png')
      - model.export_importance_report('output/importance_report.md')

# ================== 权重配置建议 ==================
recommended_weights:
  # 方案1: 均衡模式
  balanced:
    chanlun_base: 0.30
    chanlun_alpha: 0.25
    qlib_factors: 0.30
    technical: 0.15
  
  # 方案2: 缠论主导
  chanlun_focused:
    chanlun_base: 0.40
    chanlun_alpha: 0.35
    qlib_factors: 0.15
    technical: 0.10
  
  # 方案3: 传统主导
  traditional_focused:
    chanlun_base: 0.20
    chanlun_alpha: 0.15
    qlib_factors: 0.45
    technical: 0.20

# ================== 预期效果 ==================
expected_performance:
  baseline_model:  # 不使用缠论因子
    ic: 0.05
    annual_return: 15%
    sharpe_ratio: 1.2
    max_drawdown: 20%
  
  enhanced_model:  # 使用缠论因子
    ic: 0.08  # +60%
    annual_return: 25%  # +67%
    sharpe_ratio: 1.8  # +50%
    max_drawdown: 15%  # -25%

# ================== 版本信息 ==================
version: "1.0"
created_date: "2025-01"
author: "Warp AI Assistant"
project: "麒麟量化系统 - Phase 4.2"
