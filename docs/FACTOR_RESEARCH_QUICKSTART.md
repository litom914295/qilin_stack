# 🧪 一进二涨停板因子研究系统 - 快速启动指南

## 🚀 一分钟快速开始

### 1️⃣ 启动Web界面

```bash
cd G:/test/qilin_stack
streamlit run web/unified_dashboard.py
```

### 2️⃣ 访问因子研究功能

在浏览器中打开界面后，按以下路径导航：

```
📦 Qlib → 🗄️ 数据管理 → 🧪 因子研究
```

### 3️⃣ 开始使用

界面包含4个功能标签：

```
🧪 一进二涨停板因子研究
├── 📚 因子库          - 查看15个预定义因子
├── 🤖 LLM因子生成     - 使用DeepSeek自动生成新因子
├── ⚙️ 因子优化        - 多种方法优化因子权重
└── 📊 回测分析        - 五分位回测验证
```

## 📖 功能详解

### 📚 因子库

**15个预定义因子**，专为A股一进二涨停板策略设计：

| 排名 | 因子名称 | IC | 类别 |
|------|---------|-----|------|
| 1 | 早盘涨停 | 0.15 | timing |
| 2 | 首板优势 | 0.14 | continuous_board |
| 3 | 板块联动强度 | 0.13 | concept_synergy |
| 4 | 连板高度因子 | 0.12 | continuous_board |
| 5 | 大单净流入 | 0.11 | order_flow |

**操作步骤**：
1. 查看因子列表和统计信息
2. 按类别筛选（封板强度、连板高度等）
3. 查看IC分布图表
4. 选择感兴趣的因子用于后续优化

### 🤖 LLM因子生成

**使用DeepSeek自动生成新因子**：

**操作步骤**：
1. 设置生成数量（1-10个因子）
2. 选择关注领域：
   - 封板强度
   - 连板动量
   - 题材共振
   - 资金行为
   - 时机把握
3. 添加额外上下文（可选）
4. 点击"🚀 生成新因子"
5. 查看生成结果：
   - 因子名称和投资逻辑
   - 计算表达式
   - 预期IC
   - 质量评分

**示例输出**：
```
因子名称: 封板强度梯度因子
投资逻辑: 衡量涨停板封单量相对流通市值的比例变化...
预期IC: 0.08
质量评分: 8.0/10
```

**成本**: 约¥0.001/因子（使用DeepSeek-Chat）

### ⚙️ 因子优化

**4种权重优化方法**：

1. **IC加权** ✅ 推荐
   - 根据各因子IC大小分配权重
   - 适合: 因子IC差异较大时

2. **等权重**
   - 所有因子权重相同
   - 适合: 快速测试或因子IC接近时

3. **最大IC**
   - 只使用IC最高的单个因子
   - 适合: 有明显最优因子时

4. **岭回归**
   - 考虑因子相关性，正则化优化
   - 适合: 因子之间有相关性时

**操作步骤**：
1. 选择因子来源（预定义 / LLM生成）
2. 设置筛选参数：
   - 最小IC阈值（建议0.05）
   - 最大相关系数（建议0.7）
   - 选择因子数量（建议5-10个）
3. 选择优化方法
4. 点击"⚙️ 优化权重"
5. 查看优化结果：
   - 权重饼图
   - 因子权重数值
   - 优化后的组合IC

### 📊 回测分析

**五分位回测验证**：

**操作步骤**：
1. 确保已完成因子优化
2. 设置回测参数：
   - 分组数量（默认5）
   - 样本大小（默认200）
3. 点击"🚀 运行回测"
4. 查看回测结果：
   - 各分组收益率
   - 多空收益（Q5 - Q1）
   - 单调性检验
   - 收益柱状图

**结果示例**：
```
第5组（最高分）: +12.5%
第1组（最低分）: -3.2%
多空收益: +15.7%
单调性: ✅ 通过
```

## 💡 最佳实践

### 推荐工作流程

```
1. 📚 浏览因子库
   ↓ 了解预定义因子特性
   
2. 🤖 生成新因子（可选）
   ↓ 使用LLM探索新思路
   
3. ⚙️ 优化因子组合
   ↓ IC加权 + 去相关
   
4. 📊 回测验证
   ↓ 检查单调性和多空收益
   
5. 🎯 实盘应用
   ↓ 使用优化后的权重选股
```

### 参数建议

**因子筛选**:
- 最小IC: 0.05-0.08（太低无效，太高可能过拟合）
- 最大相关: 0.6-0.8（降低冗余）
- 因子数量: 5-10个（平衡多样性和复杂度）

**回测设置**:
- 样本量: 200+（确保统计显著性）
- 分组数: 5-10（平衡区分度和稳定性）

**LLM生成**:
- 每次生成: 3-5个因子（平衡质量和成本）
- 关注领域: 2-3个（避免过于宽泛）

## 🔧 故障排查

### 问题1: 页面无法访问

**症状**: 找不到"因子研究"标签

**解决**:
```bash
# 1. 确认文件存在
dir web\tabs\factor_research_tab.py

# 2. 重启dashboard
streamlit run web/unified_dashboard.py
```

### 问题2: LLM生成失败

**症状**: "API调用失败"

**解决**:
```bash
# 检查.env配置
type .env | findstr DEEPSEEK
# 应该看到: DEEPSEEK_API_KEY=sk-...

# 测试API连接
python -c "import os; from dotenv import load_dotenv; load_dotenv(); print('Key:', os.getenv('DEEPSEEK_API_KEY')[:10]+'...')"
```

### 问题3: 因子优化器报错

**症状**: "数据格式错误"

**解决**: 使用演示模式（模拟数据）进行测试

### 问题4: 导入错误

**症状**: `ModuleNotFoundError: No module named 'xxx'`

**解决**:
```bash
# 激活虚拟环境
.qilin\Scripts\activate

# 安装缺失依赖
pip install streamlit plotly pandas numpy scikit-learn
```

## 📊 演示数据说明

当前系统使用**模拟数据**进行演示：

✅ **可以做什么**:
- 学习因子研究流程
- 测试各种优化方法
- 理解因子组合逻辑
- 验证Web界面功能

⚠️ **注意事项**:
- IC值是模拟的，非真实市场数据
- 回测结果仅供功能演示
- 实盘使用需对接真实数据源

## 🔗 相关文档

| 文档 | 说明 |
|------|------|
| `FACTOR_SYSTEM_INTEGRATION.md` | 完整集成报告 |
| `LLM_FACTOR_DISCOVERY_GUIDE.md` | LLM因子生成详解 |
| `RDAGENT_WINDOWS_SOLUTION.md` | Windows兼容方案 |

## 📞 技术支持

**路径**: 
- 因子优化器: `app/factor_optimizer.py`
- Web界面: `web/tabs/factor_research_tab.py`
- 简化因子库: `rd_agent/factor_discovery_simple.py`
- LLM生成: `rd_agent/llm_factor_discovery.py`

**缓存位置**:
- 因子缓存: `workspace/factor_cache/`
- LLM缓存: `workspace/llm_factor_cache/`
- 优化结果: `workspace/factor_optimizer_cache/`

---

**版本**: 1.0  
**更新时间**: 2025-10-30  
**状态**: ✅ 已集成到unified_dashboard
