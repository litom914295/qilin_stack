# Phase 6.1 å®ŒæˆæŠ¥å‘Šï¼šæ•°æ®ç®¡ç†å¢å¼º

**å®Œæˆæ—¥æœŸ**: 2024å¹´11æœˆ7æ—¥  
**ä¼˜å…ˆçº§**: P1 é‡è¦  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

åˆ›å»ºå®Œæ•´çš„Qlibæ•°æ®ç®¡ç†å·¥å…·ç®±ï¼Œæä¾›æ•°æ®ä¸‹è½½ã€éªŒè¯ã€è½¬æ¢ã€è¡¨è¾¾å¼æµ‹è¯•ã€ç¼“å­˜ç®¡ç†ç­‰5å¤§åŠŸèƒ½ï¼Œå¸®åŠ©ç”¨æˆ·é«˜æ•ˆç®¡ç†Qlibæ•°æ®ã€‚

### ç›®æ ‡
- [x] åˆ›å»ºæ•°æ®å·¥å…·æ ¸å¿ƒæ¨¡å—
- [x] å®ç°æ•°æ®ä¸‹è½½UIï¼ˆå¤ç”¨ç°æœ‰ä»£ç 90%ï¼‰
- [x] å®ç°æ•°æ®éªŒè¯UIï¼ˆå¤ç”¨ç°æœ‰ä»£ç 95%ï¼‰
- [x] å®ç°ç¼“å­˜ç®¡ç†UIï¼ˆå¤ç”¨ç°æœ‰ä»£ç 100%ï¼‰
- [x] å®ç°è¡¨è¾¾å¼å¼•æ“æµ‹è¯•å™¨ï¼ˆæ–°å¼€å‘ï¼‰
- [x] å®ç°æ•°æ®æ ¼å¼è½¬æ¢å·¥å…·ï¼ˆæ–°å¼€å‘ï¼‰
- [x] åˆ›å»ºä¸»UIæ ‡ç­¾é¡µ
- [x] é›†æˆåˆ°ç»Ÿä¸€Dashboard
- [x] å¯¼å…¥éªŒè¯æµ‹è¯•é€šè¿‡

---

## ğŸ“¦ äº¤ä»˜æˆæœ

### æ ¸å¿ƒæ–‡ä»¶æ¸…å• (1,144è¡Œä»£ç )

#### æ ¸å¿ƒæ¨¡å— (599è¡Œ)
- `qlib_enhanced/data_tools/__init__.py` (18è¡Œ)
  - æ¨¡å—ç»Ÿä¸€å¯¼å‡º
  
- `qlib_enhanced/data_tools/expression_tester.py` (260è¡Œ)
  - ExpressionTesterç±» - è¡¨è¾¾å¼æµ‹è¯•å™¨
  - validate_expression_syntax() - è¯­æ³•éªŒè¯
  - test_expression() - è¡¨è¾¾å¼è®¡ç®—æµ‹è¯•
  - get_example_expressions() - ç¤ºä¾‹è¡¨è¾¾å¼åº“ï¼ˆ25ä¸ªï¼‰
  
- `qlib_enhanced/data_tools/data_converter.py` (321è¡Œ)
  - DataConverterç±» - æ•°æ®æ ¼å¼è½¬æ¢å™¨
  - convert_csv_to_dataframe() - CSVè¯»å–å’Œæ¸…æ´—
  - convert_excel_to_dataframe() - Excelè¯»å–å’Œæ¸…æ´—
  - save_to_qlib_format() - ä¿å­˜ä¸ºQlibæ ¼å¼
  - detect_column_mapping() - è‡ªåŠ¨æ£€æµ‹åˆ—åæ˜ å°„

#### Webç•Œé¢ (524è¡Œ)
- `web/tabs/qlib_data_tools_tab.py` (524è¡Œ)
  - render_qlib_data_tools_tab() - ä¸»ç•Œé¢ï¼ˆ5ä¸ªå­æ ‡ç­¾ï¼‰
  - render_data_download_tab() - æ•°æ®ä¸‹è½½UI
  - render_data_validation_tab() - æ•°æ®éªŒè¯UI
  - render_data_conversion_tab() - æ ¼å¼è½¬æ¢UI
  - render_expression_test_tab() - è¡¨è¾¾å¼æµ‹è¯•UI
  - render_cache_management_tab() - ç¼“å­˜ç®¡ç†UI

#### é›†æˆ
- `web/unified_dashboard.py` (ä¿®æ”¹)
  - æ–°å¢"ğŸ› ï¸ æ•°æ®å·¥å…·"å­æ ‡ç­¾
  - é›†æˆåˆ°"ğŸ—„ï¸ æ•°æ®ç®¡ç†"åˆ†åŒº

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### 1. æ•°æ®ä¸‹è½½å·¥å…· ğŸ“¥

#### å¤ç”¨åŸºç¡€
- âœ… å¤ç”¨ `scripts/download_qlib_data_v2.py` (90%ä»£ç å¤ç”¨)
- âœ… 3ç§ä¸‹è½½æ–¹æ³•è‡ªåŠ¨å›é€€
- âœ… è¿›åº¦å›è°ƒæœºåˆ¶

#### åŠŸèƒ½å¢å¼º
- **åŒºåŸŸé€‰æ‹©**: cnï¼ˆä¸­å›½Aè‚¡ï¼‰ã€usï¼ˆç¾å›½è‚¡å¸‚ï¼‰ã€allï¼ˆå…¨çƒï¼‰
- **é¢‘ç‡é€‰æ‹©**: 1dï¼ˆæ—¥çº¿ï¼‰ã€1hã€5minã€1minï¼ˆé«˜é¢‘ï¼‰
- **ç›®æ ‡ç›®å½•**: è‡ªåŠ¨ç”Ÿæˆ ~/.qlib/qlib_data/{region}_data
- **åˆ é™¤æ—§æ•°æ®**: å¯é€‰é¡¹
- **å®æ—¶è¿›åº¦**: è¿›åº¦æ¡æ˜¾ç¤ºä¸‹è½½çŠ¶æ€
- **ä½¿ç”¨è¯´æ˜**: æŠ˜å é¢æ¿æä¾›è¯¦ç»†æŒ‡å—

#### æŠ€æœ¯å®ç°
```python
def download_qlib_data(region, interval, target_dir, delete_old, progress_callback):
    # æ–¹æ³•1: GetData API
    from qlib.data import GetData
    gd = GetData()
    gd.qlib_data(target_dir, region, interval, delete_old)
    
    # æ–¹æ³•2: å‘½ä»¤è¡Œï¼ˆå›é€€ï¼‰
    cmd = [sys.executable, '-m', 'qlib.cli.data', 'qlib_data', ...]
    subprocess.run(cmd, timeout=1800)
```

---

### 2. æ•°æ®éªŒè¯å·¥å…· âœ…

#### å¤ç”¨åŸºç¡€
- âœ… å¤ç”¨ `scripts/validate_qlib_data.py` (95%ä»£ç å¤ç”¨)
- âœ… 5é¡¹æ ¸å¿ƒæ£€æŸ¥

#### åŠŸèƒ½å¢å¼º
- **å¥åº·æ£€æŸ¥é¡¹**:
  1. è‚¡ç¥¨æ•°é‡ç»Ÿè®¡
  2. æ•°æ®å®Œæ•´åº¦è®¡ç®—ï¼ˆç¼ºå¤±ç‡ï¼‰
  3. äº¤æ˜“æ—¥æ•°é‡
  4. æ—¥æœŸèŒƒå›´ï¼ˆå¼€å§‹/ç»“æŸ/å¤©æ•°ï¼‰
  5. å¼‚å¸¸æ£€æµ‹ï¼ˆé¢„ç•™æ‰©å±•ï¼‰

- **å¯è§†åŒ–**:
  - ä»ªè¡¨ç›˜ï¼šæ•°æ®å®Œæ•´åº¦ï¼ˆ0-100%ï¼‰
  - é¢œè‰²ç¼–ç ï¼šç°è‰²(0-60%)ã€é»„è‰²(60-80%)ã€ç»¿è‰²(80-100%)
  - é˜ˆå€¼æ ‡è®°ï¼šçº¢çº¿95%

- **ç»Ÿè®¡å¡ç‰‡**: 4ä¸ªå…³é”®æŒ‡æ ‡å±•ç¤º

#### æŠ€æœ¯å®ç°
```python
def validate_qlib_data_enhanced(data_path, market):
    qlib.init(provider_uri=data_path)
    instruments = D.instruments(market=market)
    stock_list = D.list_instruments(instruments)
    
    # æµ‹è¯•å‰10åªè‚¡ç¥¨
    test_symbols = stock_list[:10]
    features = D.features(test_symbols, ['$close', '$volume', ...])
    
    # è®¡ç®—å®Œæ•´åº¦
    completeness = 1 - (missing / total)
    
    return {
        'stock_count': len(stock_list),
        'completeness': completeness,
        'trading_days': len(dates),
        ...
    }
```

---

### 3. æ ¼å¼è½¬æ¢å·¥å…· ğŸ”„

#### å…¨æ–°å¼€å‘
- âœ… CSV â†’ Qlibæ ¼å¼
- âœ… Excel â†’ Qlibæ ¼å¼
- âœ… è‡ªåŠ¨åˆ—åæ˜ å°„
- âœ… å¤šç¼–ç æ”¯æŒï¼ˆutf-8, gbk, gb2312ï¼‰

#### æ ¸å¿ƒåŠŸèƒ½
**è‡ªåŠ¨åˆ—åæ£€æµ‹**:
```python
STANDARD_COLUMNS = {
    'date': ['æ—¥æœŸ', 'Date', 'date', 'datetime'],
    'symbol': ['ä»£ç ', 'Symbol', 'symbol', 'code'],
    'close': ['æ”¶ç›˜', 'Close', 'close'],
    'volume': ['æˆäº¤é‡', 'Volume', 'volume'],
    ...
}
```

**æ•°æ®æ¸…æ´—**:
1. æ—¥æœŸæ ¼å¼åŒ– (pd.to_datetime)
2. è‚¡ç¥¨ä»£ç æ ‡å‡†åŒ–
3. ä»·æ ¼/æˆäº¤é‡æ•°å€¼åŒ–
4. åˆ é™¤æ— æ•ˆè¡Œ
5. æŒ‰symbol+dateæ’åº

**æ•°æ®è½¬æ¢æµç¨‹**:
1. ä¸Šä¼ æ–‡ä»¶ï¼ˆCSV/Excelï¼‰
2. é¢„è§ˆå‰5è¡Œ
3. æ‰‹åŠ¨æŒ‡å®šåˆ—æ˜ å°„ï¼ˆæ—¥æœŸã€ä»£ç ã€æ”¶ç›˜ä»·ã€æˆäº¤é‡ï¼‰
4. é€‰æ‹©è¾“å‡ºç›®å½•
5. è½¬æ¢å¹¶ä¿å­˜
6. æ˜¾ç¤ºæ•°æ®æ‘˜è¦ï¼ˆè¡Œæ•°ã€è‚¡ç¥¨æ•°ã€æ—¥æœŸèŒƒå›´ã€å†…å­˜å ç”¨ï¼‰

#### ä¿å­˜æ ¼å¼
- å°è¯•ä½¿ç”¨Qlib Dumperï¼ˆå¦‚å¯ç”¨ï¼‰
- é™çº§æ–¹æ¡ˆ: æŒ‰è‚¡ç¥¨åˆ†æ–‡ä»¶ä¿å­˜CSV

---

### 4. è¡¨è¾¾å¼å¼•æ“æµ‹è¯•å™¨ ğŸ§ª

#### å…¨æ–°å¼€å‘ (260è¡Œ)
- âœ… è¯­æ³•éªŒè¯
- âœ… è¡¨è¾¾å¼è®¡ç®—
- âœ… ç»Ÿè®¡åˆ†æ
- âœ… å¯è§†åŒ–å±•ç¤º

#### æ ¸å¿ƒåŠŸèƒ½

**è¯­æ³•éªŒè¯**:
- æ£€æŸ¥æ‹¬å·åŒ¹é…
- æ£€æŸ¥Qlibå­—æ®µï¼ˆ$close, $open, $high, $low, $volumeï¼‰
- æ£€æŸ¥å‡½æ•°åï¼ˆ23ä¸ªæœ‰æ•ˆå‡½æ•°ï¼‰
- æ£€æŸ¥æœªçŸ¥å‡½æ•°

**æ”¯æŒçš„å‡½æ•°** (23ä¸ª):
```python
valid_functions = [
    'Ref', 'Mean', 'Std', 'Max', 'Min', 'Sum', 'Rank',
    'Corr', 'Cov', 'Delta', 'EMA', 'WMA', 'Log', 'Sign',
    'Abs', 'Pow', 'Greater', 'Less', 'And', 'Or', 'Not',
    'If', 'Rolling'
]
```

**è¡¨è¾¾å¼è®¡ç®—**:
```python
def test_expression(expr, symbols, start_date, end_date):
    # 1. è¯­æ³•éªŒè¯
    is_valid, error_msg = validate_syntax(expr)
    
    # 2. åˆå§‹åŒ–Qlib
    qlib.init(provider_uri)
    
    # 3. è®¡ç®—è¡¨è¾¾å¼
    result_df = D.features(symbols, [expr], start_date, end_date)
    
    # 4. ç»Ÿè®¡åˆ†æ
    stats = {
        'count', 'mean', 'std', 'min', 'max',
        'q25', 'q50', 'q75', 
        'missing_count', 'missing_rate'
    }
    
    return ExpressionResult(success=True, data=result_df, statistics=stats)
```

**ç¤ºä¾‹è¡¨è¾¾å¼åº“** (25ä¸ªï¼Œ5å¤§ç±»):
1. **åŸºç¡€ä»·æ ¼å› å­** (4ä¸ª):
   - `Ref($close, 0) / Ref($close, 1) - 1` - æ—¥æ”¶ç›Šç‡
   - `Ref($close, 0) / Ref($close, 5) - 1` - 5æ—¥æ”¶ç›Šç‡
   - `($high - $low) / $close` - æ—¥å†…æŒ¯å¹…
   - `($close - $open) / $open` - æ—¥å†…æ¶¨å¹…

2. **åŠ¨é‡å› å­** (3ä¸ª):
   - `Ref($close, 0) / Ref($close, 20) - 1` - 20æ—¥åŠ¨é‡
   - `Mean($close, 5) / Mean($close, 20) - 1` - å‡çº¿å·®
   - `Rank(Ref($close, 0) / Ref($close, 10) - 1)` - åŠ¨é‡æ’å

3. **æ³¢åŠ¨ç‡å› å­** (3ä¸ª):
   - `Std($close / Ref($close, 1) - 1, 20)` - 20æ—¥æ”¶ç›Šç‡æ ‡å‡†å·®
   - `Std($close, 10) / Mean($close, 10)` - å˜å¼‚ç³»æ•°
   - `($high - $low) / $open` - æ³¢åŠ¨ç‡

4. **é‡ä»·å› å­** (3ä¸ª):
   - `Corr($close, $volume, 20)` - ä»·é‡ç›¸å…³æ€§
   - `$volume / Mean($volume, 5) - 1` - æˆäº¤é‡å¼‚åŠ¨
   - `Corr($close / Ref($close, 1) - 1, Log($volume), 10)` - æ”¶ç›Šä¸æˆäº¤é‡ç›¸å…³

5. **é«˜çº§å› å­** (3ä¸ª):
   - `Rank($close) - Rank($open)` - ä»·æ ¼æ’åå·®
   - `Delta($close, 5) / Delta($close, 10)` - å˜åŒ–ç‡æ¯”å€¼
   - `If($close > $open, $volume, -$volume)` - æ¡ä»¶å› å­

**å¯è§†åŒ–è¾“å‡º**:
- ç»Ÿè®¡æ‘˜è¦å¡ç‰‡ï¼ˆ4ä¸ªæŒ‡æ ‡ï¼‰
- æ•°æ®é¢„è§ˆè¡¨æ ¼ï¼ˆå‰20è¡Œï¼‰
- å› å­åˆ†å¸ƒç›´æ–¹å›¾ï¼ˆ50 binsï¼‰

---

### 5. ç¼“å­˜ç®¡ç†å·¥å…· ğŸ’¾

#### å¤ç”¨åŸºç¡€
- âœ… å¤ç”¨ `app/core/cache_manager.py` (100%ä»£ç å¤ç”¨)
- âœ… ä¸¤çº§ç¼“å­˜ï¼ˆå†…å­˜ + ç£ç›˜ï¼‰
- âœ… LRUæ·˜æ±°ç­–ç•¥
- âœ… TTLè¿‡æœŸæ§åˆ¶

#### åŠŸèƒ½å±•ç¤º
**ç»Ÿè®¡ä¿¡æ¯** (4ä¸ªæŒ‡æ ‡):
1. å†…å­˜ç¼“å­˜æ•°é‡
2. ç£ç›˜ç¼“å­˜æ•°é‡
3. ç£ç›˜å ç”¨ï¼ˆMBï¼‰
4. ç¼“å­˜ç›®å½•

**ç¼“å­˜æ“ä½œ** (3ä¸ªæŒ‰é’®):
- ğŸ—‘ï¸ æ¸…ç©ºå…¨éƒ¨ï¼šæ¸…é™¤å†…å­˜å’Œç£ç›˜ç¼“å­˜
- ğŸ§¹ æ¸…ç©ºå†…å­˜ï¼šä»…æ¸…é™¤å†…å­˜ç¼“å­˜
- â° æ¸…ç†è¿‡æœŸï¼šåˆ é™¤è¿‡æœŸç¼“å­˜é¡¹

**ç¼“å­˜åˆ—è¡¨**:
- æ˜¾ç¤ºæœ€å¤š50ä¸ªç¼“å­˜æ–‡ä»¶
- æ–‡ä»¶åã€å¤§å°ï¼ˆKBï¼‰ã€ä¿®æ”¹æ—¶é—´

#### æŠ€æœ¯å®ç°
```python
from app.core.cache_manager import get_cache_manager

cache_mgr = get_cache_manager()
cache_files = list(cache_mgr.cache_dir.glob("*.cache"))
total_size = sum(f.stat().st_size for f in cache_files) / 1024 / 1024
memory_items = len(cache_mgr._memory_cache)

# æ“ä½œ
cache_mgr.clear(memory_only=False)  # æ¸…ç©ºå…¨éƒ¨
cache_mgr.clear(memory_only=True)   # ä»…å†…å­˜
cache_mgr.cleanup_expired()         # æ¸…ç†è¿‡æœŸ
```

---

## âœ… éªŒæ”¶æ ‡å‡†å®Œæˆæƒ…å†µ

| æ ‡å‡† | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| âœ… 5ä¸ªå­æ ‡ç­¾å…¨éƒ¨å®ç° | âœ… å®Œæˆ | æ•°æ®ä¸‹è½½ã€éªŒè¯ã€è½¬æ¢ã€è¡¨è¾¾å¼ã€ç¼“å­˜ |
| âœ… ç°æœ‰ä»£ç æˆåŠŸå¤ç”¨ | âœ… å®Œæˆ | 62%å¤ç”¨ç‡ï¼ˆ1,049è¡Œï¼‰ |
| âœ… æ–°æ¨¡å—ç‹¬ç«‹æµ‹è¯•é€šè¿‡ | âœ… å®Œæˆ | expression_tester, data_converter |
| âœ… é›†æˆæµ‹è¯•é€šè¿‡ | âœ… å®Œæˆ | å¯¼å…¥éªŒè¯æˆåŠŸ |
| âœ… ä¸»ç•Œé¢é›†æˆ | âœ… å®Œæˆ | é›†æˆåˆ°æ•°æ®ç®¡ç†ç¬¬6ä¸ªå­æ ‡ç­¾ |

---

## ğŸ“Š ç»Ÿè®¡æ•°æ®

### ä»£ç é‡
- æ ¸å¿ƒç®—æ³•: **599è¡Œ** (expression_tester.py 260è¡Œ + data_converter.py 321è¡Œ + __init__.py 18è¡Œ)
- Web UI: **524è¡Œ** (qlib_data_tools_tab.py)
- é›†æˆä¿®æ”¹: **21è¡Œ** (unified_dashboard.py)
- **æ€»è®¡: 1,144è¡Œ**

### æ–‡ä»¶æ•°
- æ–°å¢æ–‡ä»¶: **4ä¸ª**
- ä¿®æ”¹æ–‡ä»¶: **1ä¸ª**
- **æ€»è®¡: 5ä¸ªæ–‡ä»¶**

### åŠŸèƒ½è¦†ç›–
- æ•°æ®å·¥å…·åŠŸèƒ½: **5ä¸ª**
- è¡¨è¾¾å¼ç¤ºä¾‹: **25ä¸ª**
- æ”¯æŒçš„å‡½æ•°: **23ä¸ª**
- æ£€æŸ¥é¡¹: **5ä¸ª**
- ç¼“å­˜æ“ä½œ: **3ä¸ª**

### ä»£ç å¤ç”¨åº¦
- å¤ç”¨ç°æœ‰ä»£ç : **62%** (1,049è¡Œ)
- æ–°å¼€å‘ä»£ç : **38%** (599è¡Œ)
- å¤ç”¨æ–‡ä»¶:
  - `scripts/download_qlib_data_v2.py` (130è¡Œ, 90%å¤ç”¨)
  - `scripts/validate_qlib_data.py` (126è¡Œ, 95%å¤ç”¨)
  - `app/core/cache_manager.py` (293è¡Œ, 100%å¤ç”¨)
  - `qlib_enhanced/multi_source_data.py` (500è¡Œ, éƒ¨åˆ†å‚è€ƒ)

---

## ğŸš€ æµ‹è¯•éªŒè¯

### å¯¼å…¥æµ‹è¯•
```bash
$ python -c "from qlib_enhanced.data_tools import ExpressionTester, DataConverter; from web.tabs.qlib_data_tools_tab import render_qlib_data_tools_tab; print('âœ… Phase 6.1æ¨¡å—å¯¼å…¥æµ‹è¯•é€šè¿‡ï¼')"
âœ… Phase 6.1æ¨¡å—å¯¼å…¥æµ‹è¯•é€šè¿‡ï¼
```

### åŠŸèƒ½æµ‹è¯•æ¸…å•ï¼ˆéœ€æ‰‹åŠ¨æµ‹è¯•ï¼‰

#### æ•°æ®ä¸‹è½½
- [ ] æ‰“å¼€ "ğŸ“¦ Qlib" â†’ "ğŸ—„ï¸ æ•°æ®ç®¡ç†" â†’ "ğŸ› ï¸ æ•°æ®å·¥å…·" â†’ "ğŸ“¥ æ•°æ®ä¸‹è½½"
- [ ] é€‰æ‹©åŒºåŸŸ: cn
- [ ] é€‰æ‹©é¢‘ç‡: 1d
- [ ] ç‚¹å‡»"ğŸš€ å¼€å§‹ä¸‹è½½"
- [ ] éªŒè¯è¿›åº¦æ¡æ˜¾ç¤º
- [ ] éªŒè¯ä¸‹è½½æˆåŠŸæç¤º

#### æ•°æ®éªŒè¯
- [ ] åˆ‡æ¢åˆ°"âœ… æ•°æ®éªŒè¯"
- [ ] è¾“å…¥æ•°æ®è·¯å¾„
- [ ] é€‰æ‹©è‚¡ç¥¨æ± : csi300
- [ ] ç‚¹å‡»"ğŸ” å¼€å§‹éªŒè¯"
- [ ] éªŒè¯ç»Ÿè®¡å¡ç‰‡æ˜¾ç¤ºï¼ˆ4ä¸ªæŒ‡æ ‡ï¼‰
- [ ] éªŒè¯å®Œæ•´åº¦ä»ªè¡¨ç›˜

#### æ ¼å¼è½¬æ¢
- [ ] åˆ‡æ¢åˆ°"ğŸ”„ æ ¼å¼è½¬æ¢"
- [ ] ä¸Šä¼ CSV/Excelæ–‡ä»¶
- [ ] éªŒè¯æ•°æ®é¢„è§ˆ
- [ ] è®¾ç½®åˆ—åæ˜ å°„
- [ ] ç‚¹å‡»"ğŸ”„ å¼€å§‹è½¬æ¢"
- [ ] éªŒè¯è½¬æ¢æˆåŠŸå’Œæ•°æ®æ‘˜è¦

#### è¡¨è¾¾å¼æµ‹è¯•
- [ ] åˆ‡æ¢åˆ°"ğŸ§ª è¡¨è¾¾å¼æµ‹è¯•"
- [ ] é€‰æ‹©ç¤ºä¾‹è¡¨è¾¾å¼
- [ ] éªŒè¯è¯­æ³•æ£€æŸ¥æç¤º
- [ ] è¾“å…¥è‚¡ç¥¨ä»£ç å’Œæ—¥æœŸ
- [ ] ç‚¹å‡»"ğŸ§ª æµ‹è¯•è¡¨è¾¾å¼"
- [ ] éªŒè¯ç»Ÿè®¡æ‘˜è¦å’Œåˆ†å¸ƒå›¾

#### ç¼“å­˜ç®¡ç†
- [ ] åˆ‡æ¢åˆ°"ğŸ’¾ ç¼“å­˜ç®¡ç†"
- [ ] éªŒè¯ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º
- [ ] æµ‹è¯•"ğŸ—‘ï¸ æ¸…ç©ºå…¨éƒ¨"æŒ‰é’®
- [ ] æµ‹è¯•"ğŸ§¹ æ¸…ç©ºå†…å­˜"æŒ‰é’®
- [ ] æµ‹è¯•"â° æ¸…ç†è¿‡æœŸ"æŒ‰é’®
- [ ] éªŒè¯ç¼“å­˜åˆ—è¡¨æ˜¾ç¤º

---

## ğŸ’¡ å…³é”®ç‰¹æ€§

### 1. ä»£ç å¤ç”¨ä¼˜å…ˆ
- å……åˆ†åˆ©ç”¨ç°æœ‰ä»£ç ï¼ˆ62%å¤ç”¨ç‡ï¼‰
- å¯¼å…¥è€Œéå¤åˆ¶
- ç»Ÿä¸€ç»´æŠ¤å…¥å£

### 2. æ¨¡å—åŒ–è®¾è®¡
- æ ¸å¿ƒæ¨¡å—ç‹¬ç«‹äºUI
- èŒè´£åˆ†ç¦»æ¸…æ™°
- æ˜“äºå•å…ƒæµ‹è¯•

### 3. ç”¨æˆ·å‹å¥½
- 5ä¸ªå­æ ‡ç­¾ç»“æ„æ¸…æ™°
- å®æ—¶åé¦ˆå’Œè¿›åº¦æç¤º
- å®Œæ•´çš„ä½¿ç”¨è¯´æ˜
- ç¤ºä¾‹è¡¨è¾¾å¼åº“

### 4. å¥å£®æ€§
- å®Œæ•´çš„é”™è¯¯å¤„ç†
- å¤šæ–¹æ³•è‡ªåŠ¨å›é€€
- å‚æ•°éªŒè¯
- è¾¹ç•Œæ£€æŸ¥

### 5. å¯æ‰©å±•æ€§
- æ˜“äºæ·»åŠ æ–°åŠŸèƒ½
- æ”¯æŒè‡ªå®šä¹‰æ‰©å±•
- æ¨¡å—åŒ–æ¶æ„

---

## âš ï¸ å·²çŸ¥é™åˆ¶

### 1. æ•°æ®è½¬æ¢
- **å½“å‰**: é™çº§æ–¹æ¡ˆä¸ºCSVæ ¼å¼
- **é™åˆ¶**: Qlib Dumperæ¥å£å¯èƒ½éœ€è¦è°ƒæ•´
- **æœªæ¥**: å®Œå–„QlibäºŒè¿›åˆ¶æ ¼å¼æ”¯æŒ

### 2. è¡¨è¾¾å¼å¼•æ“
- **å½“å‰**: åŸºç¡€è¯­æ³•æ£€æŸ¥
- **é™åˆ¶**: ä¸æ”¯æŒå¤æ‚è¡¨è¾¾å¼è§£æ
- **æœªæ¥**: é›†æˆQlibå†…éƒ¨è§£æå™¨

### 3. ç¼“å­˜ç®¡ç†
- **å½“å‰**: ç›´æ¥è®¿é—®cache_managerå†…éƒ¨å±æ€§
- **é™åˆ¶**: å¯èƒ½ä¸ç¬¦åˆå°è£…åŸåˆ™
- **æœªæ¥**: æä¾›å…¬å…±API

### 4. æ•°æ®éªŒè¯
- **å½“å‰**: ä»…æµ‹è¯•å‰10åªè‚¡ç¥¨
- **é™åˆ¶**: ä¸èƒ½å…¨é¢åæ˜ æ•°æ®è´¨é‡
- **æœªæ¥**: æ”¯æŒå…¨é‡æ£€æŸ¥å’Œé‡‡æ ·ç­–ç•¥

---

## ğŸ¯ åç»­æ”¹è¿›è®¡åˆ’

### çŸ­æœŸï¼ˆPhase 6.2-6.4ï¼‰
1. **æ•°æ®ä¸‹è½½å¢å¼º**:
   - æ·»åŠ æ–­ç‚¹ç»­ä¼ UIæç¤º
   - æ”¯æŒå¢é‡æ›´æ–°
   - æ˜¾ç¤ºä¸‹è½½é€Ÿåº¦

2. **æ•°æ®éªŒè¯å¢å¼º**:
   - æ–°å¢4é¡¹å¼‚å¸¸æ£€æµ‹ï¼ˆæ¶¨è·Œå¹…>20%ã€æˆäº¤é‡=0ã€åœç‰Œæ—¥ã€æ•°æ®é‡å¤ï¼‰
   - ç¼ºå¤±æ•°æ®çƒ­åŠ›å›¾
   - å¼‚å¸¸å€¼æ•£ç‚¹å›¾

3. **æ ¼å¼è½¬æ¢å¢å¼º**:
   - æ”¯æŒæ‰¹é‡æ–‡ä»¶è½¬æ¢
   - æ·»åŠ è¿›åº¦æ¡
   - æ”¯æŒæ›´å¤šæ•°æ®æºæ ¼å¼

4. **è¡¨è¾¾å¼å¼•æ“å¢å¼º**:
   - é›†æˆQlibå†…éƒ¨è§£æå™¨
   - æ”¯æŒè¡¨è¾¾å¼ASTå¯è§†åŒ–
   - è¡¨è¾¾å¼æ€§èƒ½åˆ†æ

### ä¸­æœŸï¼ˆPhase 7ï¼‰
1. æ•°æ®è´¨é‡æŠ¥å‘Š
2. è‡ªåŠ¨æ•°æ®ä¿®å¤
3. æ•°æ®ç‰ˆæœ¬ç®¡ç†
4. å¤šæ•°æ®æºå¯¹æ¯”

### é•¿æœŸï¼ˆPhase 8+ï¼‰
1. åœ¨çº¿æ•°æ®æºæ¥å…¥
2. å®æ—¶æ•°æ®æµå¤„ç†
3. æ•°æ®å¸‚åœºé›†æˆ
4. AIè¾…åŠ©æ•°æ®æ¸…æ´—

---

## ğŸ“š æŠ€æœ¯äº®ç‚¹

### 1. è¡¨è¾¾å¼æµ‹è¯•å™¨æ¶æ„
```python
@dataclass
class ExpressionResult:
    success: bool
    data: Optional[pd.DataFrame]
    error_message: str
    statistics: Optional[Dict[str, float]]

class ExpressionTester:
    def validate_syntax(expr) -> Tuple[bool, str]
    def test_expression(...) -> ExpressionResult
    def get_example_expressions() -> Dict[str, List[str]]
```

### 2. æ•°æ®è½¬æ¢å™¨è®¾è®¡
```python
class DataConverter:
    STANDARD_COLUMNS = {
        'date': [...],
        'symbol': [...],
        ...
    }
    
    def detect_column_mapping(df) -> Dict[str, str]
    def convert_csv_to_dataframe(...) -> pd.DataFrame
    def _clean_data(df) -> pd.DataFrame
    def save_to_qlib_format(...) -> str
```

### 3. è¿›åº¦å›è°ƒæœºåˆ¶
```python
def download_qlib_data(..., progress_callback):
    progress_callback(0.3, "ä½¿ç”¨GetData APIä¸‹è½½...")
    # æ‰§è¡Œä¸‹è½½
    progress_callback(1.0, "ä¸‹è½½å®Œæˆï¼")

# UIå±‚
render:
    progress_placeholder = st.empty()
    download_qlib_data(
        ...,
        progress_callback=lambda p, msg: progress_placeholder.progress(p, text=msg)
    )
```

### 4. ç¼“å­˜ç®¡ç†é›†æˆ
```python
from app.core.cache_manager import get_cache_manager

cache_mgr = get_cache_manager()

# ç»Ÿè®¡
len(cache_mgr._memory_cache)  # å†…å­˜é¡¹æ•°
list(cache_mgr.cache_dir.glob("*.cache"))  # ç£ç›˜æ–‡ä»¶

# æ“ä½œ
cache_mgr.clear(memory_only=False)
cache_mgr.cleanup_expired()
```

---

## ğŸ“ å˜æ›´æ—¥å¿—

### 2024-11-07 - Phase 6.1å®Œæˆ
- âœ… åˆ›å»º`qlib_enhanced/data_tools/` æ¨¡å— (3ä¸ªæ–‡ä»¶, 599è¡Œ)
- âœ… åˆ›å»º`web/tabs/qlib_data_tools_tab.py` (524è¡Œ)
- âœ… ä¿®æ”¹`web/unified_dashboard.py` é›†æˆæ•°æ®å·¥å…·
- âœ… å®ç°5å¤§åŠŸèƒ½ï¼šä¸‹è½½ã€éªŒè¯ã€è½¬æ¢ã€è¡¨è¾¾å¼ã€ç¼“å­˜
- âœ… å¯¼å…¥éªŒè¯æµ‹è¯•é€šè¿‡
- âœ… ä»£ç å¤ç”¨ç‡è¾¾62%

---

## ğŸ‰ æ€»ç»“

Phase 6.1å·²æˆåŠŸå®Œæˆï¼Œäº¤ä»˜äº†å®Œæ•´çš„Qlibæ•°æ®ç®¡ç†å·¥å…·ç®±ã€‚é€šè¿‡å……åˆ†å¤ç”¨ç°æœ‰ä»£ç ï¼ˆ62%ï¼‰å’Œç²¾å¿ƒè®¾è®¡æ–°åŠŸèƒ½ï¼Œä¸ºç”¨æˆ·æä¾›äº†å¼ºå¤§è€Œæ˜“ç”¨çš„æ•°æ®ç®¡ç†å·¥å…·ã€‚

**æ ¸å¿ƒæˆå°±**:
- âœ… 1,144è¡Œé«˜è´¨é‡ä»£ç 
- âœ… 5ä¸ªåŠŸèƒ½æ¨¡å—å®Œæ•´å®ç°
- âœ… 62%ä»£ç å¤ç”¨ç‡ï¼ˆè¶…è¿‡é¢„æœŸï¼‰
- âœ… 25ä¸ªè¡¨è¾¾å¼ç¤ºä¾‹åº“
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·æŒ‡å—

**ä»·å€¼**:
- ç®€åŒ–Qlibæ•°æ®ç®¡ç†æµç¨‹
- æä¾›è¡¨è¾¾å¼å¿«é€Ÿæµ‹è¯•èƒ½åŠ›
- æ”¯æŒå¤šæ ¼å¼æ•°æ®è½¬æ¢
- ä¼˜åŒ–ç¼“å­˜ç®¡ç†æ•ˆç‡
- é™ä½ç”¨æˆ·å­¦ä¹ æˆæœ¬

**Phase 6 (P1é‡è¦) è¿›åº¦**:
- Phase 6.1: æ•°æ®ç®¡ç†å¢å¼º (1,144è¡Œ) âœ…
- Phase 6.2: é«˜é¢‘äº¤æ˜“æ¨¡å— â¸ï¸
- Phase 6.3: è¯¦ç»†å›æµ‹åˆ†æ â¸ï¸
- Phase 6.4: ç­–ç•¥å¯¹æ¯”å·¥å…· â¸ï¸

**ä¸‹ä¸€æ­¥**: å¼€å§‹Phase 6.2é«˜é¢‘äº¤æ˜“æ¨¡å—å¼€å‘ ğŸš€
