# ğŸ—ï¸ Qilin Stackæ·±åº¦æ¶æ„æŒ‡å—

> **æ ¸å¿ƒ**ï¼šQlibé‡åŒ–å¹³å° + RD-Agentå› å­å‘ç° + å› å­è¿›åŒ–æ·˜æ±° + æ¨¡å‹åœ¨çº¿å­¦ä¹ çš„å®Œæ•´é—­ç¯ç³»ç»Ÿ

**ç‰ˆæœ¬**: v2.0  
**æ›´æ–°æ—¥æœŸ**: 2025-10-30  
**ä½œè€…**: Qilin Quant Team

---

## ğŸ¯ ç³»ç»Ÿæ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Qilin Stack ä¸€è¿›äºŒAIäº¤æ˜“ç³»ç»Ÿ                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
   ğŸ“Š æ•°æ®å±‚          ğŸ§ª ç ”ç©¶å±‚            ğŸ¯ å†³ç­–å±‚
        â”‚                   â”‚                   â”‚
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Qlib         â”‚   â”‚ RD-Agent     â”‚   â”‚ Phase 1      â”‚
â”‚ å¤šæºæ•°æ®     â”‚â”€â”€â–¶â”‚ å› å­å‘ç°     â”‚â”€â”€â–¶â”‚ ç«ä»·è¿›é˜¶     â”‚
â”‚ AKShare      â”‚   â”‚ 15+ æ ¸å¿ƒå› å­ â”‚   â”‚ æ•°æ®å®¡è®¡     â”‚
â”‚ Tushare      â”‚   â”‚ è‡ªåŠ¨è¿›åŒ–     â”‚   â”‚ ç‰¹å¾ç²¾ç®€     â”‚
â”‚ é«˜é¢‘æ•°æ®     â”‚   â”‚              â”‚   â”‚ Walk-Forward â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   ä¸€è¿›äºŒæ¨¡å‹     â”‚
                  â”‚ LightGBM+XGBoost â”‚
                  â”‚ +CatBoost Stack  â”‚
                  â”‚ åœ¨çº¿å­¦ä¹ +è¿›åŒ–    â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚           â”‚           â”‚
        ğŸ“ˆ æ‰§è¡Œå±‚      ğŸ”„ å­¦ä¹ å±‚      ğŸ›¡ï¸ é£æ§å±‚
                â”‚           â”‚           â”‚
                â–¼           â–¼           â–¼
         T+1 ç«ä»·ä¹°å…¥   æ¨¡å‹è¿›åŒ–    å› å­è¡°å‡ç›‘æ§
         T+2 å–å‡º       å› å­æ·˜æ±°    ç”Ÿå‘½å‘¨æœŸç®¡ç†
         Kellyä»“ä½      æ¦‚å¿µæ¼‚ç§»æ£€æµ‹  å¤šçº§é£æ§
```

---

## ğŸ“Š ç¬¬ä¸€å±‚ï¼šQlibæ•°æ®åŸºç¡€è®¾æ–½

### 1.1 Qlibæ˜¯ä»€ä¹ˆï¼Ÿ

**Qlib** æ˜¯å¾®è½¯å¼€æºçš„AIé‡åŒ–æŠ•èµ„å¹³å°ï¼Œæä¾›ï¼š
- âœ… **ç»Ÿä¸€æ•°æ®æ¥å£**ï¼šæ”¯æŒå¤šç§æ•°æ®æº
- âœ… **é«˜æ€§èƒ½å› å­å¼•æ“**ï¼šå¿«é€Ÿè®¡ç®—å¤æ‚å› å­
- âœ… **æ¨¡å‹è®­ç»ƒæ¡†æ¶**ï¼šæ”¯æŒå„ç§æœºå™¨å­¦ä¹ æ¨¡å‹
- âœ… **å›æµ‹ç³»ç»Ÿ**ï¼šå®Œæ•´çš„ç­–ç•¥å›æµ‹èƒ½åŠ›

### 1.2 æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨Qlibï¼Ÿ

#### æ•°æ®è·å–ï¼ˆMultiSourceDataProviderï¼‰

**ä»£ç ä½ç½®**ï¼š`qlib_enhanced/multi_source.py`

```python
from qlib_enhanced.multi_source import MultiSourceDataProvider

# åˆå§‹åŒ–å¤šæºæ•°æ®æä¾›è€…
data_provider = MultiSourceDataProvider(
    sources=['qlib', 'akshare', 'tushare'],  # å¤šæ•°æ®æº
    fallback_order=['qlib', 'akshare', 'tushare']  # é™çº§é¡ºåº
)

# è·å–æ•°æ®ï¼ˆè‡ªåŠ¨åˆ‡æ¢æ•°æ®æºï¼‰
data = data_provider.fetch_data(
    symbols=['000001.SZ', '600000.SH'],
    start_date='2024-01-01',
    end_date='2024-12-31',
    fields=['open', 'high', 'low', 'close', 'volume']
)
```

**æ™ºèƒ½é™çº§æœºåˆ¶**ï¼š
1. ä¼˜å…ˆå°è¯•Qlibæœ¬åœ°æ•°æ®ï¼ˆæœ€å¿«ï¼‰
2. Qlibå¤±è´¥ â†’ åˆ‡æ¢åˆ°AKShareï¼ˆå…è´¹ï¼‰
3. AKShareå¤±è´¥ â†’ åˆ‡æ¢åˆ°Tushareï¼ˆéœ€Tokenï¼‰
4. æ‰€æœ‰å¤±è´¥ â†’ è¿”å›ç¼“å­˜æ•°æ®æˆ–é”™è¯¯

#### é«˜é¢‘æ•°æ®å¢å¼ºï¼ˆHighFreqLimitUpAnalyzerï¼‰

**ä»£ç ä½ç½®**ï¼š`qlib_enhanced/high_freq_limitup.py`

```python
from qlib_enhanced.high_freq_limitup import HighFreqLimitUpAnalyzer

analyzer = HighFreqLimitUpAnalyzer(freq="1min")

# åˆ†ææ¶¨åœæ¿é«˜é¢‘ç‰¹å¾
features = analyzer.analyze_intraday_pattern(
    minute_data=minute_df,  # åˆ†é’ŸKçº¿
    limitup_time="10:30:00"  # æ¶¨åœæ—¶é—´
)

# è¾“å‡ºç‰¹å¾ï¼š
# - æ¶¨åœå‰é‡èƒ½çˆ†å‘ (volume_burst_before_limit)
# - å°å•ç¨³å®šæ€§ (seal_stability)
# - å¤§å•èŠ‚å¥ (big_order_rhythm)
# - æ”¶ç›˜å°å•å¼ºåº¦ (close_seal_strength)
# - ç›˜ä¸­å¼€æ¿æ¬¡æ•° (intraday_open_count)
```

---

## ğŸ§ª ç¬¬äºŒå±‚ï¼šRD-Agentå› å­å‘ç°å¼•æ“

### 2.1 RD-Agentæ˜¯ä»€ä¹ˆï¼Ÿ

**RD-Agent** (Research & Development Agent) æ˜¯å¾®è½¯çš„AIç ”å‘åŠ©æ‰‹ï¼Œç”¨äºï¼š
- âœ… **è‡ªåŠ¨å› å­å‘ç°**ï¼šç”¨AIç”Ÿæˆæ–°å› å­
- âœ… **å› å­è¡¨è¾¾å¼ä¼˜åŒ–**ï¼šè‡ªåŠ¨ç®€åŒ–å¤æ‚å› å­
- âœ… **å› å­æœ‰æ•ˆæ€§è¯„ä¼°**ï¼šICã€IRã€å¤æ™®ç‡ç­‰

### 2.2 æˆ‘ä»¬çš„å› å­åº“ï¼ˆ15+æ ¸å¿ƒå› å­ï¼‰

**ä»£ç ä½ç½®**ï¼š`rd_agent/factor_discovery_simple.py`

#### æ¶¨åœæ¿ä¸“å±å› å­

```python
# 1. å°å•å¼ºåº¦å› å­
å°å•å¼ºåº¦ = å°å•é‡‘é¢ / æµé€šå¸‚å€¼
# è¯´æ˜ï¼šè¡¡é‡èµ„é‡‘å°æ¿åŠ›åº¦
# é¢„æœŸICï¼š0.08

# 2. è¿æ¿é«˜åº¦å› å­
è¿æ¿é«˜åº¦ = log(è¿æ¿å¤©æ•° + 1) Ã— é‡æ¯”
# è¯´æ˜ï¼šè¿æ¿è¶Šé«˜+é‡èƒ½é…åˆï¼Œæ¬¡æ—¥è¶Šå¼º
# é¢„æœŸICï¼š0.12

# 3. é¢˜æå…±æŒ¯å› å­
é¢˜æå…±æŒ¯ = åŒé¢˜ææ¶¨åœæ•°é‡ Ã— ä¸ªè‚¡å¼ºåº¦
# è¯´æ˜ï¼šé¢˜æçƒ­åº¦ä¸ä¸ªè‚¡ç»“åˆ
# é¢„æœŸICï¼š0.10

# 4. æ—©ç›˜æ¶¨åœå› å­
æ—©ç›˜æ¶¨åœ = 1 - (æ¶¨åœåˆ†é’Ÿæ•° / 240)
# è¯´æ˜ï¼šæ¶¨åœè¶Šæ—©ï¼Œæ¬¡æ—¥è¡¨ç°è¶Šå¥½
# é¢„æœŸICï¼š0.15

# 5. é‡èƒ½çˆ†å‘å› å­
é‡èƒ½çˆ†å‘ = æˆäº¤é‡ / 20æ—¥å‡é‡
# è¯´æ˜ï¼šé‡èƒ½çªå¢çš„åŠ›åº¦
# é¢„æœŸICï¼š0.09

# 6. å¤§å•å‡€æµå…¥å› å­
å¤§å•å‡€æµå…¥ = (å¤§å•ä¹°å…¥ - å¤§å•å–å‡º) / æˆäº¤é¢
# è¯´æ˜ï¼šä¸»åŠ›èµ„é‡‘æµå‘
# é¢„æœŸICï¼š0.11

# 7. å°å•æŒç»­æ€§å› å­
å°å•æŒç»­æ€§ = å°å•æŒç»­åˆ†é’Ÿæ•° / 240
# è¯´æ˜ï¼šå°å•çš„ç¨³å®šç¨‹åº¦
# é¢„æœŸICï¼š0.07

# 8. å¼€æ¿æ¬¡æ•°æƒ©ç½šå› å­
å¼€æ¿æƒ©ç½š = exp(-å¼€æ¿æ¬¡æ•°)
# è¯´æ˜ï¼šå¼€æ¿è¶Šå¤šï¼Œæ¬¡æ—¥è¶Šå¼±
# é¢„æœŸICï¼š-0.06

# 9. æ¢æ‰‹ç‡é€‚ä¸­å› å­
æ¢æ‰‹é€‚ä¸­ = 1 - |æ¢æ‰‹ç‡ - æœ€ä¼˜æ¢æ‰‹ç‡| / æœ€ä¼˜æ¢æ‰‹ç‡
# è¯´æ˜ï¼šæ¢æ‰‹ç‡è¿‡é«˜æˆ–è¿‡ä½éƒ½ä¸å¥½
# é¢„æœŸICï¼š0.08

# 10. é¦–æ¿ä¼˜åŠ¿å› å­
é¦–æ¿ä¼˜åŠ¿ = is_first_board Ã— (1 + é¢˜æçƒ­åº¦)
# è¯´æ˜ï¼šé¦–æ¿ä¸”é¢˜æçƒ­çš„è‚¡ç¥¨æœºä¼šå¤§
# é¢„æœŸICï¼š0.14
```

### 2.3 å› å­å‘ç°æµç¨‹

```python
from rd_agent.factor_discovery_simple import SimplifiedFactorDiscovery

# åˆå§‹åŒ–å› å­å‘ç°ç³»ç»Ÿ
discovery = SimplifiedFactorDiscovery(
    cache_dir="./workspace/factor_cache"
)

# å‘ç°æ–°å› å­
discovered_factors = await discovery.discover_factors(
    start_date='2024-01-01',
    end_date='2024-12-31',
    n_factors=20,  # è¿”å›Top 20å› å­
    min_ic=0.05     # æœ€å°ICé˜ˆå€¼
)

# è¾“å‡ºç¤ºä¾‹ï¼š
# [
#   {
#     'id': 'limitup_004',
#     'name': 'æ—©ç›˜æ¶¨åœ',
#     'expression': '1 - (æ¶¨åœåˆ†é’Ÿæ•° / 240)',
#     'expected_ic': 0.15,
#     'status': 'discovered'
#   },
#   ...
# ]
```

---

## ğŸ”„ ç¬¬ä¸‰å±‚ï¼šå› å­ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆè¿›åŒ–ä¸æ·˜æ±°ï¼‰

### 3.1 ä¸ºä»€ä¹ˆéœ€è¦å› å­ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Ÿ

**é—®é¢˜**ï¼š
- âŒ å› å­ä¼šè¡°å‡ï¼šæœ‰æ•ˆçš„å› å­éšæ—¶é—´å¤±æ•ˆ
- âŒ è¿‡å¤šå› å­ï¼š100+å› å­å¯¼è‡´è¿‡æ‹Ÿåˆ
- âŒ é™æ€æƒé‡ï¼šæ— æ³•é€‚åº”å¸‚åœºå˜åŒ–

**è§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… **åŠ¨æ€ç›‘æ§**ï¼šå®æ—¶è®¡ç®—å› å­IC
- âœ… **è‡ªåŠ¨é™æƒ**ï¼šè¡°å‡å› å­é™ä½æƒé‡
- âœ… **è‡ªåŠ¨æ·˜æ±°**ï¼šå¤±æ•ˆå› å­é€å…¥å†·å®«
- âœ… **è‡ªåŠ¨å¤æ´»**ï¼šæ¢å¤çš„å› å­é‡æ–°å¯ç”¨

### 3.2 å› å­çŠ¶æ€æœº

**ä»£ç ä½ç½®**ï¼š`factors/factor_lifecycle_manager.py`

```
                    ICæ¢å¤
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                      â”‚
         â–¼                      â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
  â”‚   æ´»è·ƒ     â”‚ ICè¡°å‡  â”‚   è§‚å¯Ÿ     â”‚
  â”‚ Active    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Watching   â”‚
  â”‚ æƒé‡100%  â”‚         â”‚ æƒé‡75%    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ICç»§ç»­è¡°å‡
                              â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   è­¦å‘Š     â”‚
                        â”‚ Warning    â”‚
                        â”‚ æƒé‡50%    â”‚
                        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ICè¿‡ä½
                             â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   ä¼‘çœ      â”‚
                        â”‚ Sleeping   â”‚
                        â”‚ æƒé‡0%     â”‚
                        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ä¼‘çœ >120å¤©
                             â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   æ·˜æ±°     â”‚
                        â”‚ Eliminated â”‚
                        â”‚ æ°¸ä¹…ç§»é™¤   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 è½¬æ¢è§„åˆ™

**Active â†’ Watching**ï¼ˆæ´»è·ƒâ†’è§‚å¯Ÿï¼‰
```python
è§¦å‘æ¡ä»¶ï¼š
- ICä¸‹é™è‡³å†å²å‡å€¼çš„80%
- èƒœç‡ä½äº52%
- è¿ç»­20å¤©è¡¨ç°ä¸ä½³
```

**Watching â†’ Warning**ï¼ˆè§‚å¯Ÿâ†’è­¦å‘Šï¼‰
```python
è§¦å‘æ¡ä»¶ï¼š
- ICä¸‹é™è‡³å†å²å‡å€¼çš„50%
- èƒœç‡ä½äº48%
- è¿ç»­30å¤©è¡¨ç°ä¸ä½³
```

**Warning â†’ Sleeping**ï¼ˆè­¦å‘Šâ†’ä¼‘çœ ï¼‰
```python
è§¦å‘æ¡ä»¶ï¼š
- ICç»å¯¹å€¼ä½äº0.01
- è¿ç»­40å¤©è¡¨ç°ä¸ä½³
- IRä½äº0.3
```

**Sleeping â†’ Eliminated**ï¼ˆä¼‘çœ â†’æ·˜æ±°ï¼‰
```python
è§¦å‘æ¡ä»¶ï¼š
- ä¼‘çœ è¶…è¿‡120å¤©
- å°è¯•å¤æ´»3æ¬¡å‡å¤±è´¥
```

**å¤æ´»æ¡ä»¶**ï¼ˆä»»ä½•çŠ¶æ€ â†’ Active/Watchingï¼‰
```python
è§¦å‘æ¡ä»¶ï¼š
- ICæ¢å¤è‡³0.03ä»¥ä¸Š
- è¿ç»­20å¤©è¡¨ç°è‰¯å¥½
- èƒœç‡é«˜äº55%
```

### 3.4 ä½¿ç”¨ç¤ºä¾‹

```python
from factors.factor_lifecycle_manager import FactorLifecycleManager

# åˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨
manager = FactorLifecycleManager()

# æ›´æ–°å› å­çŠ¶æ€
for factor_name in all_factors:
    # è·å–å› å­å¥åº·åº¦æŒ‡æ ‡ï¼ˆæ¥è‡ªFactorDecayMonitorï¼‰
    health_metrics = {
        'ic_mean': 0.05,
        'ic_recent': 0.03,
        'ic_win_rate': 0.54,
        'ir': 0.8,
        'ic_trend': 'declining'
    }
    
    # æ›´æ–°çŠ¶æ€
    status = manager.update_factor_status(
        factor_name=factor_name,
        health_metrics=health_metrics
    )
    
    print(f"{factor_name}: {status['status'].value}, æƒé‡={status['weight']}")

# è·å–æ´»è·ƒå› å­
active_factors = manager.get_active_factors()
print(f"æ´»è·ƒå› å­æ•°: {len(active_factors)}")
```

---

## ğŸ“ˆ ç¬¬å››å±‚ï¼šæ¨¡å‹è®­ç»ƒä¸é›†æˆ

### 4.1 ä¸€è¿›äºŒæ¨¡å‹æ¶æ„

**ä»£ç ä½ç½®**ï¼š`qlib_enhanced/one_into_two_pipeline.py`

#### ä¸¤é˜¶æ®µStackingæ¨¡å‹

```python
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Stage 1: Pool Prediction    â”‚
â”‚   é¢„æµ‹Tæ—¥æ˜¯å¦æ¶¨åœï¼ˆå€™é€‰æ± ï¼‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Base Models (L1)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ LightGBMâ”‚ XGBoost  â”‚ CatBoost â”‚  â”‚
â”‚  â”‚ 200æ£µæ ‘ â”‚ 300æ£µæ ‘  â”‚ 300è¿­ä»£  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Meta Model (L2)                     â”‚
â”‚  Logistic Regression + Calibration   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
         Pool Probability
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Stage 2: Board Prediction       â”‚
â”‚   é¢„æµ‹T+1æ˜¯å¦ç»§ç»­æ¶¨åœï¼ˆäºŒæ¿ï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Base Models (L1)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ LightGBMâ”‚ XGBoost  â”‚ CatBoost â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Meta Model (L2)                     â”‚
â”‚  Logistic Regression + Calibration   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
        Board Probability
          (æœ€ç»ˆè¾“å‡º)
```

#### æ¨¡å‹é…ç½®

**LightGBM**:
```python
lgb.LGBMClassifier(
    n_estimators=200,
    max_depth=-1,  # æ— é™åˆ¶
    learning_rate=0.05,
    num_leaves=31,
    subsample=0.8,
    colsample_bytree=0.8
)
```

**XGBoost**:
```python
xgb.XGBClassifier(
    n_estimators=300,
    max_depth=5,
    learning_rate=0.05,
    subsample=0.8,
    colsample_bytree=0.8,
    tree_method='hist'  # å¿«é€Ÿç›´æ–¹å›¾ç®—æ³•
)
```

**CatBoost**:
```python
CatBoostClassifier(
    iterations=300,
    depth=6,
    learning_rate=0.05,
    loss_function='Logloss',
    verbose=False
)
```

### 4.2 è®­ç»ƒæµç¨‹

```python
from qlib_enhanced.one_into_two_pipeline import OneIntoTwoTrainer

# åˆå§‹åŒ–è®­ç»ƒå™¨
trainer = OneIntoTwoTrainer(top_n=20)

# å‡†å¤‡æ•°æ®
# df: DataFrame with columns:
#   - date: äº¤æ˜“æ—¥æœŸ
#   - symbol: è‚¡ç¥¨ä»£ç 
#   - pool_label: Tæ—¥æ˜¯å¦æ¶¨åœ (0/1)
#   - board_label: T+1æ˜¯å¦ç»§ç»­æ¶¨åœ (0/1)
#   - feature_1, feature_2, ...: ç‰¹å¾åˆ—

# è®­ç»ƒæ¨¡å‹
result = trainer.fit(df)

print(f"Pool Model AUC: {result.auc_pool:.4f}")
print(f"Board Model AUC: {result.auc_board:.4f}")
print(f"Top-{trainer.top_n} Threshold: {result.threshold_topn:.4f}")

# é¢„æµ‹
predictions = trainer.predict(new_data)
# è¿”å›: (pool_prob, board_prob)
```

---

## ğŸ”„ ç¬¬äº”å±‚ï¼šåœ¨çº¿å­¦ä¹ ä¸æ¨¡å‹è¿›åŒ–

### 5.1 ä¸ºä»€ä¹ˆéœ€è¦åœ¨çº¿å­¦ä¹ ï¼Ÿ

**é—®é¢˜**ï¼š
- âŒ å¸‚åœºåœ¨å˜åŒ–ï¼šé™æ€æ¨¡å‹å¾ˆå¿«å¤±æ•ˆ
- âŒ æ¦‚å¿µæ¼‚ç§»ï¼šè¿‡å»æœ‰æ•ˆçš„ç‰¹å¾ç°åœ¨æ— æ•ˆ
- âŒ æ•°æ®åˆ†å¸ƒå˜åŒ–ï¼šæ–°çš„å¸‚åœºregime

**è§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… **å¢é‡æ›´æ–°**ï¼šæ¯æ—¥/æ¯å‘¨æ›´æ–°æ¨¡å‹
- âœ… **æ¦‚å¿µæ¼‚ç§»æ£€æµ‹**ï¼šè‡ªåŠ¨æ£€æµ‹å¸‚åœºå˜åŒ–
- âœ… **è‡ªé€‚åº”å­¦ä¹ ç‡**ï¼šæ ¹æ®è¡¨ç°è°ƒæ•´å­¦ä¹ é€Ÿåº¦
- âœ… **æ¨¡å‹ç‰ˆæœ¬ç®¡ç†**ï¼šä¿ç•™å†å²æ¨¡å‹ç”¨äºå¯¹æ¯”

### 5.2 åœ¨çº¿å­¦ä¹ ç®¡ç†å™¨

**ä»£ç ä½ç½®**ï¼š`qlib_enhanced/online_learning.py`

```python
from qlib_enhanced.online_learning import OnlineLearningManager

# åˆå§‹åŒ–åœ¨çº¿å­¦ä¹ ç®¡ç†å™¨
manager = OnlineLearningManager(
    base_model=trained_model,
    update_frequency='daily',  # æ¯æ—¥æ›´æ–°
    drift_threshold=0.05,      # æ¼‚ç§»æ£€æµ‹é˜ˆå€¼
    enable_drift_detection=True
)

# å¢é‡æ›´æ–°ï¼ˆæ¯å¤©æ”¶ç›˜åï¼‰
result = await manager.incremental_update(
    new_data=today_features,   # ä»Šæ—¥ç‰¹å¾
    new_labels=today_labels     # ä»Šæ—¥æ ‡ç­¾
)

if result.success:
    print(f"âœ… æ¨¡å‹æ›´æ–°æˆåŠŸ")
    print(f"  å¤„ç†æ ·æœ¬: {result.samples_processed}")
    print(f"  æ–°å‡†ç¡®ç‡: {result.new_accuracy:.4f}")
    print(f"  æ¦‚å¿µæ¼‚ç§»: {'æ˜¯' if result.drift_detected else 'å¦'}")
    print(f"  æ¨¡å‹ç‰ˆæœ¬: {result.model_version}")
else:
    print(f"âŒ æ¨¡å‹æ›´æ–°å¤±è´¥")
```

### 5.3 æ¦‚å¿µæ¼‚ç§»æ£€æµ‹

```python
class DriftDetector:
    """æ¦‚å¿µæ¼‚ç§»æ£€æµ‹å™¨"""
    
    def detect(self, new_data, new_labels):
        # 1. ç‰¹å¾åˆ†å¸ƒå˜åŒ–æ£€æµ‹ï¼ˆKSæ£€éªŒï¼‰
        feature_drift = self._check_feature_distribution(new_data)
        
        # 2. æ ‡ç­¾åˆ†å¸ƒå˜åŒ–æ£€æµ‹
        label_drift = self._check_label_distribution(new_labels)
        
        # 3. æ¨¡å‹æ€§èƒ½ä¸‹é™æ£€æµ‹
        performance_drift = self._check_performance_degradation()
        
        # ç»¼åˆåˆ¤æ–­
        drift_score = (
            feature_drift * 0.4 + 
            label_drift * 0.3 + 
            performance_drift * 0.3
        )
        
        return ConceptDrift(
            detected=drift_score > self.threshold,
            drift_score=drift_score,
            detection_time=datetime.now(),
            affected_features=self._get_drifted_features(),
            recommended_action='retrain' if drift_score > 0.1 else 'update'
        )
```

---

## ğŸ¯ ç¬¬å…­å±‚ï¼šç«ä»·è¿›é˜¶Pipelineï¼ˆé›†æˆæ‰€æœ‰æ¨¡å—ï¼‰

### 6.1 UnifiedPhase1Pipelineå®Œæ•´æµç¨‹

**ä»£ç ä½ç½®**ï¼š`qlib_enhanced/unified_phase1_pipeline.py`

```python
from qlib_enhanced.unified_phase1_pipeline import UnifiedPhase1Pipeline

# åˆå§‹åŒ–ç»Ÿä¸€Pipeline
pipeline = UnifiedPhase1Pipeline(
    config={
        'data_quality': {
            'min_coverage': 0.95,
            'max_missing_ratio': 0.05
        },
        'feature_selection': {
            'max_features': 50,
            'min_importance': 0.01
        },
        'factor_health': {
            'ic_windows': [20, 60, 120],
            'min_ic': 0.02
        },
        'walk_forward': {
            'train_window': 180,
            'test_window': 60,
            'step_size': 30
        }
    }
)
```

### 6.2 å®Œæ•´å·¥ä½œæµ

#### Step 1: æ•°æ®è´¨é‡å®¡è®¡

```python
# å®¡è®¡å¤šæºæ•°æ®è´¨é‡
audit_results = pipeline.run_data_quality_audit({
    'qlib': qlib_data,
    'akshare': akshare_data,
    'tushare': tushare_data
})

# è¾“å‡ºï¼š
# âœ… æ•°æ®è´¨é‡å®¡è®¡å®Œæˆ
#   è¦†ç›–ç‡: 98.5%
#   ç¼ºå¤±å€¼æ¯”ä¾‹: 1.2%
#   å¼‚å¸¸å€¼æ¯”ä¾‹: 0.8%
```

#### Step 2: RD-Agentå› å­å‘ç°

```python
from rd_agent.factor_discovery_simple import SimplifiedFactorDiscovery

discovery = SimplifiedFactorDiscovery()

# å‘ç°æ–°å› å­
new_factors = await discovery.discover_factors(
    start_date='2024-01-01',
    end_date='2024-12-31',
    n_factors=20,
    min_ic=0.05
)

# è¾“å‡ºï¼š
# ğŸ” å¼€å§‹å› å­å‘ç°: 2024-01-01 -> 2024-12-31
# âœ… å‘ç° 20 ä¸ªé«˜è´¨é‡å› å­
```

#### Step 3: ç”Ÿæˆæ ¸å¿ƒç‰¹å¾

```python
# ä»100+ç‰¹å¾ç²¾ç®€åˆ°50ä¸ªæ ¸å¿ƒç‰¹å¾
core_features = pipeline.generate_core_features(
    full_feature_df=all_features,
    target_col='t1_close_return'
)

# è¾“å‡ºï¼š
# âœ… ç‰¹å¾ç²¾ç®€å®Œæˆ: 120 â†’ 50
```

#### Step 4: å› å­å¥åº·åº¦ç›‘æ§

```python
# ç›‘æ§å› å­ICå’Œç”Ÿå‘½å‘¨æœŸ
health_report = pipeline.monitor_factor_health(
    factor_data=core_features,
    forward_returns=t1_returns
)

# è¾“å‡ºï¼š
# âœ… æ´»è·ƒå› å­æ•°: 32/50
#   - å°å•å¼ºåº¦: IC=0.08, çŠ¶æ€=Active
#   - è¿æ¿é«˜åº¦: IC=0.12, çŠ¶æ€=Active
#   - é¢˜æå…±æŒ¯: IC=0.10, çŠ¶æ€=Active
#   - æ—©ç›˜æ¶¨åœ: IC=0.15, çŠ¶æ€=Active
#   ...
#   - æŸå¼±å› å­: IC=0.008, çŠ¶æ€=Sleeping
```

#### Step 5: Walk-ForwardéªŒè¯

```python
# æ»šåŠ¨è®­ç»ƒå’Œæµ‹è¯•
wf_results = pipeline.run_walk_forward_validation(
    df=full_data,
    feature_cols=active_features,  # åªç”¨æ´»è·ƒå› å­
    target_col='board_label',
    date_col='date'
)

# è¾“å‡ºï¼š
# Walk-Forward éªŒè¯ç»“æœ:
#   è®­ç»ƒçª—å£: 180å¤©
#   æµ‹è¯•çª—å£: 60å¤©
#   æ­¥é•¿: 30å¤©
#   æŠ˜æ•°: 8
#   å¹³å‡AUC: 0.73
#   AUCæ ‡å‡†å·®: 0.04
#   ç¨³å®šæ€§: ä¼˜ç§€
```

#### Step 6: è®­ç»ƒæœ€ç»ˆæ¨¡å‹

```python
# ä½¿ç”¨æ´»è·ƒå› å­è®­ç»ƒä¸€è¿›äºŒæ¨¡å‹
from qlib_enhanced.one_into_two_pipeline import OneIntoTwoTrainer

trainer = OneIntoTwoTrainer(top_n=20)
result = trainer.fit(core_features)

print(f"Pool Model AUC: {result.auc_pool:.4f}")
print(f"Board Model AUC: {result.auc_board:.4f}")

# è¾“å‡ºï¼š
# Pool Model AUC: 0.68
# Board Model AUC: 0.74
```

#### Step 7: åœ¨çº¿å­¦ä¹ å¯åŠ¨

```python
from qlib_enhanced.online_learning import OnlineLearningManager

# å¯åŠ¨åœ¨çº¿å­¦ä¹ 
manager = OnlineLearningManager(
    base_model=result.model_board,
    update_frequency='daily'
)

# æ¯æ—¥æ”¶ç›˜åè‡ªåŠ¨æ›´æ–°
# (åœ¨schedulerä¸­é…ç½®å®šæ—¶ä»»åŠ¡)
```

---

## ğŸ”§ å¦‚ä½•æ­£ç¡®ä½¿ç”¨æ•´å¥—ç³»ç»Ÿï¼Ÿ

### å®Œæ•´ä½¿ç”¨æµç¨‹

#### 1. åˆå§‹åŒ–ï¼ˆä¸€æ¬¡æ€§ï¼‰

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# ä¸‹è½½Qlibæ•°æ®
python scripts/download_qlib_data_v2.py --start 2020-01-01 --end 2024-12-31

# åˆå§‹åŒ–å› å­åº“
python rd_agent/factor_discovery_simple.py
```

#### 2. Tæ—¥ç›˜åï¼ˆ15:30-16:30ï¼‰

**è¿è¡Œç«ä»·è¿›é˜¶Pipeline**:

```python
# å¯åŠ¨Webç•Œé¢
streamlit run web/unified_dashboard.py

# åœ¨ç•Œé¢ä¸­ï¼š
# 1. ç«ä»·å†³ç­– â†’ Tæ—¥å€™é€‰ç­›é€‰ â†’ æ‰§è¡Œç­›é€‰
# 2. ç«ä»·å†³ç­– â†’ ç«ä»·è¿›é˜¶ â†’ å®Œæ•´Pipeline
```

**åå°æ‰§è¡Œé€»è¾‘**:

```python
# 1. è·å–å€™é€‰è‚¡ç¥¨
candidates = auction_engine.screen_tomorrow_candidates_strict(
    today_limitups=limitup_data,
    features=full_features
)

# 2. ç«ä»·è¿›é˜¶ä¼˜åŒ–
pipeline = UnifiedPhase1Pipeline()

# 2.1 æ•°æ®è´¨é‡å®¡è®¡
audit_results = pipeline.run_data_quality_audit(data_sources)

# 2.2 ç”Ÿæˆæ ¸å¿ƒç‰¹å¾ï¼ˆç²¾ç®€åˆ°50ä¸ªï¼‰
core_features = pipeline.generate_core_features(
    full_feature_df=all_features
)

# 2.3 å› å­å¥åº·åº¦ç›‘æ§
health_report = pipeline.monitor_factor_health(
    factor_data=core_features,
    forward_returns=t1_returns
)

# 2.4 è·å–æ´»è·ƒå› å­
active_factors = pipeline.get_active_factors()
print(f"æ´»è·ƒå› å­: {len(active_factors)}/{len(all_factors)}")

# 2.5 Walk-ForwardéªŒè¯
wf_results = pipeline.run_walk_forward_validation(
    df=candidates,
    feature_cols=active_factors,
    target_col='board_label'
)

# 2.6 è®­ç»ƒ/æ›´æ–°æ¨¡å‹
trainer = OneIntoTwoTrainer()
result = trainer.fit(candidates[['date', 'symbol', 'pool_label', 'board_label'] + active_factors])

# 2.7 ç”Ÿæˆé¢„æµ‹
candidates['pred_prob'] = result.model_board.predict_proba(candidates[active_factors])[:, 1]

# 2.8 æŒ‰æ¦‚ç‡æ’åºï¼Œé€‰Top 10
final_candidates = candidates.nlargest(10, 'pred_prob')
```

#### 3. T+1æ—¥ç«ä»·ï¼ˆ09:15-09:25ï¼‰

```python
# ç›‘æ§ç«ä»·å¼ºåº¦
auction_monitor = AuctionMonitor()

for symbol in final_candidates['symbol']:
    # è®¡ç®—ç«ä»·å¼ºåº¦
    strength = auction_monitor.calculate_strength(symbol)
    
    # åˆ†çº§å†³ç­–
    if strength >= 85:
        action = 'auction_buy'  # ç«ä»·ä¹°å…¥
    elif strength >= 70:
        action = 'open_observe' # å¼€ç›˜è§‚å¯Ÿ
    else:
        action = 'pass'         # æ”¾å¼ƒ
```

#### 4. T+2æ—¥å–å‡ºï¼ˆ09:15-09:25ï¼‰

```python
# æ ¹æ®T+1è¡¨ç°åˆ¶å®šå–å‡ºç­–ç•¥
sell_strategy = T2SellStrategy()

for position in current_positions:
    t1_return = position['t1_close_return']
    t2_open_gap = position['t2_open_gap']
    
    sell_signal = sell_strategy.generate_signal(t1_return, t2_open_gap)
    
    # æ‰§è¡Œå–å‡º
    if sell_signal.sell_ratio > 0:
        execute_sell(position, sell_signal.sell_ratio)
```

#### 5. æ¯æ—¥åœ¨çº¿å­¦ä¹ ï¼ˆ16:00ï¼‰

```python
# æ”¶é›†å½“æ—¥æ•°æ®
today_data = collect_today_data()
today_labels = collect_today_labels()

# å¢é‡æ›´æ–°æ¨¡å‹
online_manager = OnlineLearningManager(base_model=current_model)
result = await online_manager.incremental_update(today_data, today_labels)

if result.drift_detected:
    print("âš ï¸  æ£€æµ‹åˆ°æ¦‚å¿µæ¼‚ç§»ï¼Œè§¦å‘å®Œå…¨é‡è®­ç»ƒ")
    # é‡æ–°è¿è¡Œå®Œæ•´Pipeline
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡ä¸ç›‘æ§

### å…³é”®æŒ‡æ ‡

**å› å­å±‚é¢**:
```
- æ´»è·ƒå› å­æ•°: ç›‘æ§æœ‰æ•ˆå› å­æ•°é‡
- å¹³å‡IC: å› å­æ•´ä½“æœ‰æ•ˆæ€§
- ICèƒœç‡: IC>0çš„æ¯”ä¾‹
- å› å­è¡°å‡ç‡: ä¼‘çœ /æ·˜æ±°å› å­æ¯”ä¾‹
```

**æ¨¡å‹å±‚é¢**:
```
- Pool Model AUC: å€™é€‰æ± é¢„æµ‹å‡†ç¡®ç‡ï¼ˆç›®æ ‡>0.65ï¼‰
- Board Model AUC: äºŒæ¿é¢„æµ‹å‡†ç¡®ç‡ï¼ˆç›®æ ‡>0.70ï¼‰
- Walk-Forward AUC: ç¨³å®šæ€§æŒ‡æ ‡ï¼ˆæ ‡å‡†å·®<0.05ï¼‰
- åœ¨çº¿å­¦ä¹ å‡†ç¡®ç‡: å¢é‡æ›´æ–°æ•ˆæœ
```

**äº¤æ˜“å±‚é¢**:
```
- èƒœç‡: >60%
- ç›ˆäºæ¯”: >2:1
- å¤æ™®ç‡: >2.0
- æœ€å¤§å›æ’¤: <-10%
```

### ç›‘æ§dashboard

**Webç•Œé¢æŸ¥çœ‹**:
```
ç«ä»·å†³ç­– â†’ ç«ä»·è¿›é˜¶ â†’ æŸ¥çœ‹ç»“æœ
- æ•°æ®è´¨é‡è¯„åˆ†
- æ ¸å¿ƒç‰¹å¾æ•°
- æ´»è·ƒå› å­æ•°
- æ¨¡å‹AUC
- Walk-Forwardç¨³å®šæ€§
```

---

## ğŸ“ æ ¸å¿ƒä¼˜åŠ¿æ€»ç»“

### 1. **æ•°æ®åŸºç¡€è®¾æ–½ï¼ˆQlibï¼‰**
- âœ… å¤šæºåˆ‡æ¢ï¼Œæ°¸ä¸æ‰çº¿
- âœ… é«˜é¢‘æ•°æ®å¢å¼º
- âœ… ç»Ÿä¸€æ•°æ®æ¥å£

### 2. **æ™ºèƒ½å› å­å‘ç°ï¼ˆRD-Agentï¼‰**
- âœ… 15+æ ¸å¿ƒå› å­åº“
- âœ… è‡ªåŠ¨å› å­ç”Ÿæˆ
- âœ… å› å­æœ‰æ•ˆæ€§è¯„ä¼°

### 3. **å› å­è¿›åŒ–æ·˜æ±°**
- âœ… å®æ—¶ICç›‘æ§
- âœ… 5çº§çŠ¶æ€ç®¡ç†ï¼ˆActive/Watching/Warning/Sleeping/Eliminatedï¼‰
- âœ… è‡ªåŠ¨é™æƒ/æ·˜æ±°/å¤æ´»

### 4. **æ¨¡å‹é›†æˆå­¦ä¹ **
- âœ… LightGBM+XGBoost+CatBoostä¸‰æ¨¡å‹Stacking
- âœ… ä¸¤é˜¶æ®µé¢„æµ‹ï¼ˆPoolâ†’Boardï¼‰
- âœ… Calibrationæ ¡å‡†

### 5. **åœ¨çº¿å­¦ä¹ è¿›åŒ–**
- âœ… æ¯æ—¥å¢é‡æ›´æ–°
- âœ… æ¦‚å¿µæ¼‚ç§»æ£€æµ‹
- âœ… è‡ªé€‚åº”é‡è®­ç»ƒ

### 6. **ä¸¥æ ¼éªŒè¯**
- âœ… Walk-Forwardæ»šåŠ¨éªŒè¯
- âœ… æ—¶é—´åºåˆ—ä¸¥æ ¼åˆ‡åˆ†
- âœ… æ³›åŒ–èƒ½åŠ›è¯„ä¼°

---

## ğŸš€ å¿«é€Ÿè½åœ°å®æˆ˜æŒ‡å—

> **ç›®æ ‡**ï¼šä»é›¶å¼€å§‹ï¼Œ30åˆ†é’Ÿå†…è®©æ•´å¥—ç³»ç»Ÿè¿è½¬èµ·æ¥ï¼

### å‰ç½®å‡†å¤‡

**ç³»ç»Ÿè¦æ±‚**ï¼š
- Windows 10/11 æˆ– Linux/macOS
- Python 3.8+
- 8GB+ å†…å­˜
- 10GB+ ç¡¬ç›˜ç©ºé—´

**æ£€æŸ¥Pythonç¯å¢ƒ**ï¼š
```bash
# Windows PowerShell
python --version  # åº”è¯¥æ˜¾ç¤º 3.8+

# å¦‚æœæ²¡æœ‰Pythonï¼Œä¸‹è½½å®‰è£…ï¼š
# https://www.python.org/downloads/
```

---

### ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒåˆå§‹åŒ–ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd G:\test\qilin_stack

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆå¯é€‰ä½†å¼ºçƒˆå»ºè®®ï¼‰
python -m venv venv

# 3. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows:
.\venv\Scripts\activate
# Linux/macOS:
# source venv/bin/activate

# 4. å‡çº§pip
pip install --upgrade pip

# 5. å®‰è£…ä¾èµ–ï¼ˆé¦–æ¬¡è¿è¡Œéœ€è¦10-15åˆ†é’Ÿï¼‰
pip install -r requirements.txt
```

**å¸¸è§é—®é¢˜**ï¼š
- å¦‚æœ`requirements.txt`ä¸å­˜åœ¨ï¼Œæ‰‹åŠ¨å®‰è£…æ ¸å¿ƒä¾èµ–ï¼š
```bash
pip install pandas numpy scikit-learn lightgbm xgboost catboost streamlit plotly
```

---

### ç¬¬äºŒæ­¥ï¼šQlibæ•°æ®å‡†å¤‡ï¼ˆ10-15åˆ†é’Ÿï¼‰

#### æ–¹æ¡ˆAï¼šä½¿ç”¨Qlibå®˜æ–¹æ•°æ®ï¼ˆæ¨èï¼‰

```bash
# 1. å®‰è£…Qlib
pip install qlib

# 2. ä¸‹è½½Aè‚¡æ•°æ®ï¼ˆçº¦3GBï¼Œéœ€è¦ç½‘ç»œï¼‰
python scripts/download_qlib_data_v2.py --start 2020-01-01 --end 2024-12-31

# æˆ–è€…ä½¿ç”¨Qlibå®˜æ–¹å‘½ä»¤
python -m qlib.run.get_data qlib_data --target_dir ~/.qlib/qlib_data/cn_data --region cn
```

#### æ–¹æ¡ˆBï¼šä½¿ç”¨AKShareå®æ—¶æ•°æ®ï¼ˆå…è´¹ã€æ— éœ€ä¸‹è½½ï¼‰

```bash
# å®‰è£…AKShare
pip install akshare

# ç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨AKShareè·å–å®æ—¶æ•°æ®
# æ— éœ€é¢å¤–é…ç½®
```

**éªŒè¯æ•°æ®**ï¼š
```python
# è¿è¡Œæµ‹è¯•è„šæœ¬
python scripts/validate_qlib_data.py

# åº”è¯¥çœ‹åˆ°ï¼š
# âœ… Qlibæ•°æ®å¯ç”¨
# âœ… æ•°æ®èŒƒå›´ï¼š2020-01-01 è‡³ 2024-12-31
# âœ… è‚¡ç¥¨æ•°é‡ï¼š4000+
```

---

### ç¬¬ä¸‰æ­¥ï¼šRD-Agentå› å­å‘ç°ï¼ˆ5åˆ†é’Ÿï¼‰

#### æŸ¥çœ‹é¢„ç½®å› å­åº“

```python
# è¿›å…¥Pythonäº¤äº’å¼ç¯å¢ƒ
python

# å¯¼å…¥å› å­å‘ç°æ¨¡å—
from rd_agent.factor_discovery_simple import SimplifiedFactorDiscovery

# åˆå§‹åŒ–
discovery = SimplifiedFactorDiscovery()

# æŸ¥çœ‹é¢„ç½®å› å­åº“
for factor in discovery.factor_library:
    print(f"{factor['id']}: {factor['name']} - IC={factor['expected_ic']}")
    print(f"   {factor['expression']}")
    print()

# åº”è¯¥çœ‹åˆ°ï¼š
# limitup_001: å°å•å¼ºåº¦ - IC=0.08
#    å°å•é‡‘é¢ / æµé€šå¸‚å€¼
#
# limitup_002: è¿æ¿é«˜åº¦å› å­ - IC=0.12
#    log(è¿æ¿å¤©æ•° + 1) * é‡æ¯”
# ...

exit()  # é€€å‡ºPython
```

#### è¿è¡Œå› å­å‘ç°ï¼ˆå¼‚æ­¥ï¼‰

```python
# åˆ›å»ºæµ‹è¯•è„šæœ¬ï¼štest_factor_discovery.py
import asyncio
from rd_agent.factor_discovery_simple import SimplifiedFactorDiscovery

async def main():
    discovery = SimplifiedFactorDiscovery()
    
    # å‘ç°Top 20å› å­
    factors = await discovery.discover_factors(
        start_date='2024-01-01',
        end_date='2024-12-31',
        n_factors=20,
        min_ic=0.05
    )
    
    print(f"\nå‘ç° {len(factors)} ä¸ªé«˜è´¨é‡å› å­:")
    for f in factors:
        print(f"  - {f['name']}: IC={f['expected_ic']}")

if __name__ == "__main__":
    asyncio.run(main())
```

```bash
# è¿è¡Œ
python test_factor_discovery.py
```

---

### ç¬¬å››æ­¥ï¼šå› å­ç”Ÿå‘½å‘¨æœŸæµ‹è¯•ï¼ˆ5åˆ†é’Ÿï¼‰

```python
# åˆ›å»ºæµ‹è¯•è„šæœ¬ï¼štest_factor_lifecycle.py
from factors.factor_lifecycle_manager import FactorLifecycleManager, FactorStatus

# åˆå§‹åŒ–ç®¡ç†å™¨
manager = FactorLifecycleManager()

# æ¨¡æ‹Ÿå› å­å¥åº·åº¦æ•°æ®
test_factors = [
    ('å°å•å¼ºåº¦', {'ic_mean': 0.08, 'ic_recent': 0.075, 'ic_win_rate': 0.65, 'ir': 1.2, 'ic_trend': 'stable'}),
    ('è¿æ¿é«˜åº¦', {'ic_mean': 0.12, 'ic_recent': 0.11, 'ic_win_rate': 0.68, 'ir': 1.5, 'ic_trend': 'rising'}),
    ('æ—©ç›˜æ¶¨åœ', {'ic_mean': 0.15, 'ic_recent': 0.14, 'ic_win_rate': 0.70, 'ir': 1.8, 'ic_trend': 'stable'}),
    ('æŸå¼±å› å­', {'ic_mean': 0.02, 'ic_recent': 0.008, 'ic_win_rate': 0.48, 'ir': 0.2, 'ic_trend': 'declining'}),
]

print("å› å­ç”Ÿå‘½å‘¨æœŸç®¡ç†æµ‹è¯•\n" + "="*60)

for factor_name, health_metrics in test_factors:
    status = manager.update_factor_status(factor_name, health_metrics)
    print(f"\n{factor_name}:")
    print(f"  çŠ¶æ€: {status['status'].value}")
    print(f"  æƒé‡: {status['weight']*100:.0f}%")
    print(f"  ICå‡å€¼: {health_metrics['ic_mean']:.4f}")
    print(f"  è¶‹åŠ¿: {health_metrics['ic_trend']}")

# è·å–æ´»è·ƒå› å­
active_factors = manager.get_active_factors()
print(f"\n\nâœ… æ´»è·ƒå› å­æ•°: {len(active_factors)}/{len(test_factors)}")
print(f"æ´»è·ƒå› å­åˆ—è¡¨: {active_factors}")
```

```bash
# è¿è¡Œ
python test_factor_lifecycle.py

# åº”è¯¥çœ‹åˆ°ï¼š
# å°å•å¼ºåº¦: æ´»è·ƒï¼Œæƒé‡=100%
# è¿æ¿é«˜åº¦: æ´»è·ƒï¼Œæƒé‡=100%
# æ—©ç›˜æ¶¨åœ: æ´»è·ƒï¼Œæƒé‡=100%
# æŸå¼±å› å­: è§‚å¯Ÿ/è­¦å‘Šï¼Œæƒé‡=75%/50%
```

---

### ç¬¬äº”æ­¥ï¼šä¸€è¿›äºŒæ¨¡å‹è®­ç»ƒï¼ˆ10åˆ†é’Ÿï¼‰

#### å‡†å¤‡æ¨¡æ‹Ÿæ•°æ®

```python
# åˆ›å»ºæµ‹è¯•è„šæœ¬ï¼štest_model_training.py
import pandas as pd
import numpy as np
from datetime import datetime, timedelta
from qlib_enhanced.one_into_two_pipeline import OneIntoTwoTrainer

# ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
np.random.seed(42)
n_samples = 1000

# æ—¥æœŸèŒƒå›´
start_date = datetime(2024, 1, 1)
dates = [start_date + timedelta(days=i//50) for i in range(n_samples)]

# è‚¡ç¥¨ä»£ç 
symbols = [f"{i:06d}.SZ" for i in np.random.choice(range(1, 300000), n_samples)]

# ç”Ÿæˆç‰¹å¾
features_data = {
    'date': dates,
    'symbol': symbols,
    'seal_strength': np.random.uniform(50, 120, n_samples),  # å°å•å¼ºåº¦
    'limitup_time_score': np.random.uniform(60, 100, n_samples),  # æ¶¨åœæ—¶é—´è¯„åˆ†
    'sector_heat': np.random.uniform(0, 1, n_samples),  # æ¿å—çƒ­åº¦
    'volume_ratio': np.random.uniform(1, 5, n_samples),  # é‡æ¯”
    'turnover_rate': np.random.uniform(5, 40, n_samples),  # æ¢æ‰‹ç‡
}

# ç”Ÿæˆæ ‡ç­¾
df = pd.DataFrame(features_data)
df['pool_label'] = (df['seal_strength'] > 80).astype(int)  # Tæ—¥æ¶¨åœ
df['board_label'] = ((df['seal_strength'] > 90) & (df['pool_label'] == 1)).astype(int)  # T+1ç»§ç»­æ¶¨åœ

print(f"æ ·æœ¬æ•°é‡: {len(df)}")
print(f"Poolæ ‡ç­¾æ¯”ä¾‹: {df['pool_label'].mean():.2%}")
print(f"Boardæ ‡ç­¾æ¯”ä¾‹: {df['board_label'].mean():.2%}")

# è®­ç»ƒæ¨¡å‹
print("\nå¼€å§‹è®­ç»ƒä¸€è¿›äºŒæ¨¡å‹...")
trainer = OneIntoTwoTrainer(top_n=20)
result = trainer.fit(df)

print(f"\nâœ… è®­ç»ƒå®Œæˆï¼")
print(f"  Pool Model AUC: {result.auc_pool:.4f}")
print(f"  Board Model AUC: {result.auc_board:.4f}")
print(f"  Top-{trainer.top_n} Threshold: {result.threshold_topn:.4f}")

# é¢„æµ‹ç¤ºä¾‹
test_sample = df.head(5)[
    ['seal_strength', 'limitup_time_score', 'sector_heat', 'volume_ratio', 'turnover_rate']
]
pool_probs = result.model_pool.predict_proba(test_sample)[:, 1]
board_probs = result.model_board.predict_proba(test_sample)[:, 1]

print(f"\né¢„æµ‹ç¤ºä¾‹:")
for i in range(5):
    print(f"  è‚¡ç¥¨{i+1}: Pool={pool_probs[i]:.2%}, Board={board_probs[i]:.2%}")
```

```bash
# è¿è¡Œ
python test_model_training.py
```

---

### ç¬¬å…­æ­¥ï¼šç«ä»·è¿›é˜¶Pipelineæµ‹è¯•ï¼ˆ10åˆ†é’Ÿï¼‰

```python
# åˆ›å»ºæµ‹è¯•è„šæœ¬ï¼štest_phase1_pipeline.py
import pandas as pd
import numpy as np
from qlib_enhanced.unified_phase1_pipeline import UnifiedPhase1Pipeline

# åˆå§‹åŒ–Pipeline
print("åˆå§‹åŒ–UnifiedPhase1Pipeline...\n")
pipeline = UnifiedPhase1Pipeline(
    config={
        'data_quality': {
            'min_coverage': 0.95,
            'max_missing_ratio': 0.05
        },
        'feature_selection': {
            'max_features': 50,
            'min_importance': 0.01
        },
        'factor_health': {
            'ic_windows': [20, 60, 120],
            'min_ic': 0.02
        }
    },
    output_dir="output/test_pipeline"
)

print("âœ… Pipelineåˆå§‹åŒ–å®Œæˆ\n")
print("æ¨¡å—åˆ—è¡¨:")
print("  - DataQualityAuditor: æ•°æ®è´¨é‡å®¡è®¡")
print("  - CoreFeatureGenerator: æ ¸å¿ƒç‰¹å¾ç”Ÿæˆ")
print("  - FactorDecayMonitor: å› å­è¡°å‡ç›‘æ§")
print("  - FactorLifecycleManager: å› å­ç”Ÿå‘½å‘¨æœŸç®¡ç†")
print("  - MarketSentimentFactors: å¸‚åœºæƒ…ç»ªå› å­")
print("  - ThemeDiffusionFactors: é¢˜ææ‰©æ•£å› å­")
print("  - LiquidityVolatilityFactors: æµåŠ¨æ€§æ³¢åŠ¨ç‡å› å­")

print("\nâœ¨ ç³»ç»Ÿå°±ç»ªï¼ç°åœ¨å¯ä»¥è¿›è¡Œå®Œæ•´çš„ç«ä»·è¿›é˜¶ä¼˜åŒ–äº†ï¼")
```

```bash
# è¿è¡Œ
python test_phase1_pipeline.py
```

---

### ç¬¬ä¸ƒæ­¥ï¼šå¯åŠ¨Webç•Œé¢ï¼ˆ1åˆ†é’Ÿï¼‰

```bash
# å¯åŠ¨Streamlit Webåº”ç”¨
streamlit run web/unified_dashboard.py

# åº”è¯¥è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼šhttp://localhost:8501
# å¦‚æœæ²¡æœ‰è‡ªåŠ¨æ‰“å¼€ï¼Œæ‰‹åŠ¨å¤åˆ¶é“¾æ¥åˆ°æµè§ˆå™¨
```

**Webç•Œé¢æ“ä½œ**ï¼š

1. **å¯¼èˆªåˆ°ç«ä»·å†³ç­–**ï¼š
   - å·¦ä¾§èœå• â†’ ç«ä»·å†³ç­–

2. **Tæ—¥å€™é€‰ç­›é€‰**ï¼š
   - ç‚¹å‡»ã€ŒğŸ“Š Tæ—¥å€™é€‰ç­›é€‰ã€æ ‡ç­¾
   - è®¾ç½®ç­›é€‰æ¡ä»¶
   - ç‚¹å‡»ã€ŒğŸ” æ‰§è¡Œç­›é€‰ã€

3. **ç«ä»·è¿›é˜¶ä¼˜åŒ–**ï¼š
   - ç‚¹å‡»ã€ŒğŸ¯ ç«ä»·è¿›é˜¶ã€æ ‡ç­¾
   - åœ¨ã€ŒğŸ“Š æ•°æ®å‡†å¤‡ã€é€‰æ‹©æ•°æ®æº
   - åœ¨ã€ŒğŸ“ˆ è¿è¡ŒPipelineã€ç‚¹å‡»ã€ŒğŸš€ è¿è¡Œå®Œæ•´Pipelineã€
   - æŸ¥çœ‹ã€ŒğŸ“‹ æŸ¥çœ‹ç»“æœã€

---

### ç¬¬å…«æ­¥ï¼šéªŒè¯å®Œæ•´æµç¨‹ï¼ˆ20åˆ†é’Ÿï¼‰

#### åˆ›å»ºå®Œæ•´é›†æˆæµ‹è¯•

```python
# åˆ›å»º: test_full_workflow.py
import pandas as pd
import numpy as np
from datetime import datetime, timedelta
import asyncio

# å¯¼å…¥æ‰€æœ‰æ¨¡å—
from rd_agent.factor_discovery_simple import SimplifiedFactorDiscovery
from factors.factor_lifecycle_manager import FactorLifecycleManager
from qlib_enhanced.one_into_two_pipeline import OneIntoTwoTrainer
from qlib_enhanced.unified_phase1_pipeline import UnifiedPhase1Pipeline
from qlib_enhanced.online_learning import OnlineLearningManager

print("â”"*70)
print("ğŸš€ Qilin Stack å®Œæ•´æµç¨‹éªŒè¯")
print("â”"*70)

# ========== Phase 1: å› å­å‘ç° ==========
print("\nğŸ§ª Phase 1: RD-Agentå› å­å‘ç°")
print("-"*70)

async def discover_factors():
    discovery = SimplifiedFactorDiscovery()
    factors = await discovery.discover_factors(
        start_date='2024-01-01',
        end_date='2024-12-31',
        n_factors=15,
        min_ic=0.05
    )
    return factors

factors = asyncio.run(discover_factors())
print(f"âœ… å‘ç° {len(factors)} ä¸ªé«˜è´¨é‡å› å­")

# ========== Phase 2: å› å­ç”Ÿå‘½å‘¨æœŸç®¡ç† ==========
print("\n\nğŸ”„ Phase 2: å› å­ç”Ÿå‘½å‘¨æœŸç®¡ç†")
print("-"*70)

manager = FactorLifecycleManager()

# æ¨¡æ‹Ÿå› å­å¥åº·åº¦
for i, factor in enumerate(factors[:5]):  # åªæµ‹è¯•å‰5ä¸ª
    health_metrics = {
        'ic_mean': factor['expected_ic'],
        'ic_recent': factor['expected_ic'] * 0.9,
        'ic_win_rate': 0.60,
        'ir': 1.0,
        'ic_trend': 'stable'
    }
    status = manager.update_factor_status(factor['name'], health_metrics)

active_factors = manager.get_active_factors()
print(f"âœ… æ´»è·ƒå› å­æ•°: {len(active_factors)}")

# ========== Phase 3: æ¨¡å‹è®­ç»ƒ ==========
print("\n\nğŸ“ˆ Phase 3: ä¸€è¿›äºŒæ¨¡å‹è®­ç»ƒ")
print("-"*70)

# ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
np.random.seed(42)
n_samples = 500

df_train = pd.DataFrame({
    'date': [datetime(2024, 1, 1) + timedelta(days=i//10) for i in range(n_samples)],
    'symbol': [f"{i:06d}.SZ" for i in np.random.choice(range(1, 300000), n_samples)],
    'seal_strength': np.random.uniform(50, 120, n_samples),
    'limitup_time_score': np.random.uniform(60, 100, n_samples),
    'volume_ratio': np.random.uniform(1, 5, n_samples),
})

df_train['pool_label'] = (df_train['seal_strength'] > 80).astype(int)
df_train['board_label'] = ((df_train['seal_strength'] > 90) & (df_train['pool_label'] == 1)).astype(int)

trainer = OneIntoTwoTrainer(top_n=20)
result = trainer.fit(df_train)

print(f"âœ… Pool Model AUC: {result.auc_pool:.4f}")
print(f"âœ… Board Model AUC: {result.auc_board:.4f}")

# ========== Phase 4: Pipelineé›†æˆ ==========
print("\n\nğŸ¯ Phase 4: UnifiedPhase1Pipelineé›†æˆ")
print("-"*70)

pipeline = UnifiedPhase1Pipeline(output_dir="output/test_full")
print("âœ… Pipelineåˆå§‹åŒ–å®Œæˆ")
print("  âœ“ æ•°æ®è´¨é‡å®¡è®¡")
print("  âœ“ ç‰¹å¾ç”Ÿæˆå™¨")
print("  âœ“ å› å­ç›‘æ§å™¨")
print("  âœ“ ç”Ÿå‘½å‘¨æœŸç®¡ç†")
print("  âœ“ å¸‚åœºæƒ…ç»ªå› å­")

# ========== æ€»ç»“ ==========
print("\n\n" + "â”"*70)
print("âœ¨ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ç³»ç»Ÿå·²å°±ç»ªï¼")
print("â”"*70)
print("\nä¸‹ä¸€æ­¥æ“ä½œï¼š")
print("  1. å¯åŠ¨Webç•Œé¢ï¼šstreamlit run web/unified_dashboard.py")
print("  2. æŸ¥é˜…æ–‡æ¡£ï¼šdocs/DAILY_TRADING_SOP.md")
print("  3. å¼€å§‹å®æˆ˜æ“ä½œï¼")
print("\nğŸ‰ ç¥äº¤æ˜“é¡ºåˆ©ï¼")
```

```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•
python test_full_workflow.py
```

---

## ğŸ“Š å¿«é€Ÿå‚è€ƒï¼šå¸¸ç”¨å‘½ä»¤

### æ—¥å¸¸å¯åŠ¨

```bash
# 1. æ¿€æ´»ç¯å¢ƒ
cd G:\test\qilin_stack
.\venv\Scripts\activate  # Windows

# 2. å¯åŠ¨Webç•Œé¢
streamlit run web/unified_dashboard.py
```

### æ•°æ®æ›´æ–°

```bash
# æ›´æ–°Qlibæ•°æ®ï¼ˆæ¯å‘¨æ‰§è¡Œä¸€æ¬¡ï¼‰
python scripts/download_qlib_data_v2.py --start 2024-01-01 --end $(date +%Y-%m-%d)

# éªŒè¯æ•°æ®
python scripts/validate_qlib_data.py
```

### æ¨¡å‹è®­ç»ƒ

```bash
# é‡æ–°è®­ç»ƒä¸€è¿›äºŒæ¨¡å‹
python qlib_enhanced/one_into_two_pipeline.py

# è®­ç»ƒåŸºçº¿æ¨¡å‹
python scripts/train_baseline_model.py
```

### å› å­ç®¡ç†

```bash
# æŸ¥çœ‹å› å­å¥åº·åº¦
python -c "from factors.factor_lifecycle_manager import FactorLifecycleManager; m = FactorLifecycleManager(); print(m.get_summary())"

# é‡ç½®å› å­çŠ¶æ€ï¼ˆè°¨æ…ï¼‰
rm -rf output/factor_lifecycle/*.json
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f logs/scheduler.log

# æŸ¥çœ‹æœ€å50è¡Œ
tail -n 50 logs/scheduler.log

# æœç´¢é”™è¯¯æ—¥å¿—
findstr "ERROR" logs\scheduler.log  # Windows
# grep "ERROR" logs/scheduler.log  # Linux/macOS
```

---

## âš ï¸ å¸¸è§é—®é¢˜æ’æŸ¥

### 1. æ¨¡å—å¯¼å…¥é”™è¯¯

**é—®é¢˜**ï¼š`ModuleNotFoundError: No module named 'xxx'`

**è§£å†³**ï¼š
```bash
# ç¡®è®¤è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
which python  # åº”è¯¥æ˜¾ç¤º venv/Scripts/python

# é‡æ–°å®‰è£…ä¾èµ–
pip install -r requirements.txt

# æˆ–æ‰‹åŠ¨å®‰è£…ç¼ºå¤±çš„åŒ…
pip install <package_name>
```

### 2. Qlibæ•°æ®ä¸å¯ç”¨

**é—®é¢˜**ï¼š`QlibDataNotFound` æˆ–ç±»ä¼¼é”™è¯¯

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥Qlibæ•°æ®ç›®å½•
ls ~/.qlib/qlib_data/cn_data  # Linux/macOS
dir %USERPROFILE%\.qlib\qlib_data\cn_data  # Windows

# å¦‚æœä¸å­˜åœ¨ï¼Œé‡æ–°ä¸‹è½½
python scripts/download_qlib_data_v2.py --start 2020-01-01 --end 2024-12-31

# æˆ–ä½¿ç”¨AKShareæ›¿ä»£
pip install akshare
```

### 3. Webç•Œé¢æ— æ³•å¯åŠ¨

**é—®é¢˜**ï¼š`streamlit: command not found`

**è§£å†³**ï¼š
```bash
# å®‰è£…Streamlit
pip install streamlit

# ç¡®è®¤å®‰è£…æˆåŠŸ
streamlit --version

# å¦‚æœè¿˜æ˜¯ä¸è¡Œï¼Œä½¿ç”¨python -m
python -m streamlit run web/unified_dashboard.py
```

### 4. ç«¯å£8501å·²è¢«å ç”¨

**é—®é¢˜**ï¼š`Port 8501 is already in use`

**è§£å†³**ï¼š
```bash
# Windows: æŸ¥æ‰¾å¹¶ç»“æŸè¿›ç¨‹
netstat -ano | findstr :8501
taskkill /PID <PID> /F

# æˆ–ä½¿ç”¨å…¶ä»–ç«¯å£
streamlit run web/unified_dashboard.py --server.port 8502
```

### 5. æ¨¡å‹è®­ç»ƒè¿‡æ…¢

**é—®é¢˜**ï¼šè®­ç»ƒè€—æ—¶å¤ªé•¿

**è§£å†³**ï¼š
- å‡å°‘æ ·æœ¬æ•°é‡ï¼ˆæµ‹è¯•é˜¶æ®µï¼‰
- å‡å°‘æ¨¡å‹æ ‘æ•°é‡ï¼ˆ`n_estimators`ï¼‰
- ä½¿ç”¨GPUåŠ é€Ÿï¼ˆå¦‚æœæ”¯æŒï¼‰
- å…³é—­éƒ¨åˆ†æ¨¡å‹ï¼ˆåªç”¨LightGBMï¼‰

```python
# åœ¨ one_into_two_pipeline.py ä¸­è®¾ç½®ç¯å¢ƒå˜é‡
import os
os.environ["OIT_DISABLE_XGB"] = "1"  # ç¦ç”¨XGBoost
```

---

## ğŸ“ ä¸‹ä¸€æ­¥å­¦ä¹ è·¯å¾„

### æ–°æ‰‹è·¯å¾„ï¼ˆ1-2å‘¨ï¼‰

**ç¬¬1å¤©**ï¼šç¯å¢ƒæ­å»º + åŸºç¡€æµ‹è¯•
- âœ… å®Œæˆä¸Šé¢çš„ç¬¬ä¸€è‡³ç¬¬å…«æ­¥
- âœ… ç¡®ä¿Webç•Œé¢å¯ä»¥æ­£å¸¸å¯åŠ¨

**ç¬¬2-3å¤©**ï¼šç†è§£æ ¸å¿ƒæ¨¡å—
- é˜…è¯» `DEEP_ARCHITECTURE_GUIDE.md` (æœ¬æ–‡æ¡£)
- ç†è§£Qlibã€RD-Agentã€å› å­è¿›åŒ–ã€æ¨¡å‹æ¶æ„
- è¿è¡Œä¸Šé¢çš„æ‰€æœ‰æµ‹è¯•è„šæœ¬

**ç¬¬4-5å¤©**ï¼šå­¦ä¹ æ—¥å¸¸æ“ä½œ
- é˜…è¯» `DAILY_TRADING_SOP.md`
- å¯¹ç…§SOPæ¨¡æ‹Ÿä¸€æ¬¡å®Œæ•´æµç¨‹ï¼ˆTæ—¥â†’T+1â†’T+2ï¼‰
- ç†Ÿæ‚‰Webç•Œé¢å„ä¸ªæ ‡ç­¾é¡µ

**ç¬¬6-7å¤©**ï¼šæŒæ¡é€‰è‚¡é€»è¾‘
- é˜…è¯» `STOCK_SELECTION_GUIDE.md`
- ç†è§£ä¸‰å±‚è¿‡æ»¤ä½“ç³»
- å­¦ä¹ è´¨é‡è¯„åˆ†å’Œç«ä»·å¼ºåº¦åˆ†çº§

**ç¬¬2å‘¨**ï¼šå®ç›˜æ¨¡æ‹Ÿ
- ä½¿ç”¨å†å²æ•°æ®æ¨¡æ‹Ÿå®Œæ•´äº¤æ˜“æµç¨‹
- æ¯å¤©è®°å½•æ“ä½œå’Œå†³ç­–
- æ€»ç»“ç»éªŒå’Œæ•™è®­

### è¿›é˜¶è·¯å¾„ï¼ˆ1-3æœˆï¼‰

**æ¨¡å—å®šåˆ¶**ï¼š
- æ·»åŠ è‡ªå·±çš„å› å­åˆ° `rd_agent/factor_discovery_simple.py`
- è°ƒæ•´ç­›é€‰å‚æ•°åˆ° `app/auction_decision_engine.py`
- ä¼˜åŒ–æ¨¡å‹å‚æ•°åœ¨ `qlib_enhanced/one_into_two_pipeline.py`

**ç­–ç•¥ä¼˜åŒ–**ï¼š
- æµ‹è¯•ä¸åŒçš„ä¹°å…¥åˆ†å±‚ç­–ç•¥
- ä¼˜åŒ–å–å‡ºç­–ç•¥çŸ©é˜µ
- è°ƒæ•´Kellyä»“ä½ç®¡ç†å‚æ•°

**ç³»ç»Ÿé›†æˆ**ï¼š
- é›†æˆå®æ—¶æ•°æ®æº
- å®ç°è‡ªåŠ¨äº¤æ˜“æ¥å£
- æ­å»ºç›‘æ§å‘Šè­¦ç³»ç»Ÿ

---

## ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–æ–¹å‘

### 1. **å¼ºåŒ–å­¦ä¹ é›†æˆ**
```python
# qlib_enhanced/rl_trading.py
# ä½¿ç”¨PPO/A3Cä¼˜åŒ–ä¹°å–æ—¶æœºå’Œä»“ä½
```

### 2. **Meta Learning**
```python
# qlib_enhanced/meta_learning.py
# å¿«é€Ÿé€‚åº”æ–°å¸‚åœºç¯å¢ƒ
```

### 3. **é«˜é¢‘å› å­æ‰©å±•**
```python
# features/high_freq_factors.py
# ç§’çº§/Tickçº§å¾®è§‚ç»“æ„å› å­
```

### 4. **å› å­ç»„åˆä¼˜åŒ–**
```python
# app/factor_optimizer.py
# é—ä¼ ç®—æ³•ä¼˜åŒ–å› å­æƒé‡ç»„åˆ
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ä¸€è¿›äºŒæ“ç›˜SOP](DAILY_TRADING_SOP.md) - æ—¥å¸¸æ“ä½œæµç¨‹
- [é€‰è‚¡å†³ç­–æ‰‹å†Œ](STOCK_SELECTION_GUIDE.md) - äººå·¥é€‰è‚¡æŒ‡å—
- [ç«ä»·è¿›é˜¶ä½¿ç”¨æŒ‡å—](PHASE1_USAGE_GUIDE.md) - Pipelineè¯¦ç»†è¯´æ˜
- [APIæ–‡æ¡£](../qlib_enhanced/README.md) - æ¨¡å—APIå‚è€ƒ

---

**è¿™æ‰æ˜¯Qilin Stackçš„çœŸæ­£åŠ›é‡ï¼** ğŸš€

ä»Qlibæ•°æ®åŸºç¡€è®¾æ–½ï¼Œåˆ°RD-Agentå› å­å‘ç°ï¼Œåˆ°å› å­ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œåˆ°æ¨¡å‹åœ¨çº¿å­¦ä¹ ï¼Œå†åˆ°ç«ä»·è¿›é˜¶é›†æˆâ€”â€”**å®Œæ•´çš„AIé©±åŠ¨é‡åŒ–äº¤æ˜“ç³»ç»Ÿ**ã€‚
