# éº’éºŸç³»ç»Ÿç¼ è®ºæ¨¡å— - åç»­æ‰©å±•å‡çº§è®¡åˆ’

**è§„åˆ’å‘¨æœŸ**: 6ä¸ªæœˆ (3ä¸ªé˜¶æ®µ)  
**å½“å‰ç‰ˆæœ¬**: v1.3 (Phase 1-3 å·²å®Œæˆ)  
**ç›®æ ‡ç‰ˆæœ¬**: v2.0-stable  
**æ›´æ–°æ—¥æœŸ**: 2025-01  
**è§„åˆ’åŸåˆ™**: åŸºäºå·²å®Œæˆçš„åŒæ¨¡å¼æ¶æ„ï¼Œé’ˆå¯¹æ€§ä¼˜åŒ–å‡çº§

---

## ğŸ“‹ å½“å‰çŠ¶æ€ (v1.3)

### âœ… å·²å®ŒæˆåŠŸèƒ½ (Phase 1-3)

**Phase 1: å›æµ‹èåˆ** âœ…
- åˆ é™¤ `simple_backtest.py` (412è¡Œ)
- åˆ›å»º `models/chanlun_model.py` (259è¡Œ) - 2ä¸ªæ¨¡å‹ç±»
- åˆ›å»º `configs/chanlun/qlib_backtest.yaml` (119è¡Œ)
- å®Œå…¨è¿ç§»åˆ° Qlib å›æµ‹æ¡†æ¶

**Phase 2: ç­–ç•¥èåˆ + Webé›†æˆ** âœ…
- åˆ›å»º `strategies/chanlun_qlib_strategy.py` (324è¡Œ) - èåˆç­–ç•¥
- ä¿ç•™ `strategies/multi_agent_selector.py` - ç‹¬ç«‹ç³»ç»Ÿ
- åˆ›å»º `web/tabs/chanlun_system_tab.py` (508è¡Œ) - Webç•Œé¢
- é›†æˆåˆ° `web/unified_dashboard.py` - ä¸»ç•Œé¢ç¬¬3ä¸ªTab
- å®ç°åŒæ¨¡å¼ï¼šèåˆæ¨¡å¼ï¼ˆç»§æ‰¿TopkDropoutStrategyï¼‰+ ç‹¬ç«‹æ¨¡å¼ï¼ˆMultiAgentï¼‰

**Phase 3: Handlerä¼˜åŒ– + å› å­æ³¨å†Œ** âœ…
- åˆ›å»º `qlib_enhanced/chanlun/register_factors.py` (321è¡Œ) - 16ä¸ªå› å­æ³¨å†Œ
- åˆ›å»º `qlib_enhanced/chanlun/factor_handler.py` (244è¡Œ) - ç®€åŒ–Handler
- åˆ›å»º `configs/chanlun/factors.yaml` (194è¡Œ) - å› å­é…ç½®
- å®Œæˆå› å­ç»Ÿä¸€ç®¡ç†å’Œæ³¨å†Œæœºåˆ¶

### ğŸ¯ åŒæ¨¡å¼æ¶æ„

**æ¨¡å¼1: Qlibèåˆç³»ç»Ÿ** (å®Œå…¨é›†æˆéº’éºŸ)
```
â”œâ”€â”€ ChanLunFactorHandler - å› å­åŠ è½½
â”œâ”€â”€ ChanLunScoringModel - è¯„åˆ†æ¨¡å‹
â”œâ”€â”€ ChanLunEnhancedStrategy - èåˆç­–ç•¥ (ç»§æ‰¿TopkDropoutStrategy)
â””â”€â”€ Qlibå›æµ‹æ¡†æ¶ - å®Œæ•´å›æµ‹
```

**æ¨¡å¼2: ç‹¬ç«‹ç¼ è®ºç³»ç»Ÿ** (çº¯ç¼ è®ºé€»è¾‘)
```
â”œâ”€â”€ MultiAgentStockSelector - 5ä¸ªAgentè¯„åˆ†
â”œâ”€â”€ ChanLunScoringAgent - ç¼ è®ºæ ¸å¿ƒè¯„åˆ†
â”œâ”€â”€ Webç•Œé¢ - ç‹¬ç«‹Tab
â””â”€â”€ å¯é€‰: æ¥å…¥Qlibå›æµ‹
```

### ğŸ“Š å½“å‰æ¶æ„ä¼˜åŠ¿

1. **å¤ç”¨ç‡é«˜**: 80%å¤ç”¨Qlibæ¡†æ¶
2. **çµæ´»æ€§å¼º**: åŒæ¨¡å¼å¯æ ¹æ®åœºæ™¯é€‰æ‹©
3. **ä»£ç ç²¾ç®€**: ç´¯è®¡å‡å°‘73è¡Œé‡å¤ä»£ç 
4. **å®Œæ•´æ–‡æ¡£**: 1843è¡Œæ–‡æ¡£ä½“ç³»
5. **Webé›†æˆ**: ç‹¬ç«‹Tabï¼Œ4ä¸ªå­åŠŸèƒ½

---

## ğŸ¯ å‡çº§æ–¹å‘

### é’ˆå¯¹ Qlibèåˆç³»ç»Ÿçš„å‡çº§
- å› å­ä¼˜åŒ–å’Œæ‰©å±•
- MLæ¨¡å‹æ·±åº¦é›†æˆ
- æ€§èƒ½ä¼˜åŒ–å’Œç¼“å­˜
- å®ç›˜äº¤æ˜“å¯¹æ¥

### é’ˆå¯¹ ç‹¬ç«‹ç¼ è®ºç³»ç»Ÿçš„å‡çº§  
- å¤šçº§åˆ«ç¼ è®ºåˆ†æ
- ä¸€è¿›äºŒæ¶¨åœç­–ç•¥å¢å¼º
- å®æ—¶ä¿¡å·æ¨é€
- å¯è§†åŒ–åˆ†æå·¥å…·

---

## ğŸ¯ é˜¶æ®µå››: Qlibèåˆç³»ç»Ÿå¢å¼º (1-2æœˆ)

**ç›®æ ‡**: ä¼˜åŒ–Qlibèåˆæ¨¡å¼ï¼Œå¢å¼ºå› å­å’ŒMLé›†æˆ  
**ç‰ˆæœ¬**: v1.3 â†’ v1.5  
**å·¥ä½œé‡**: çº¦20äººå¤©

### Month 1: é›†æˆåˆ°Qlibå› å­ä½“ç³» (10äººå¤©)

#### ä»»åŠ¡1.1: ç¼ è®ºå› å­æ³¨å†Œ
**ç›®æ ‡**: å°†16ä¸ªç¼ è®ºç‰¹å¾æ³¨å†Œä¸ºQlibæ ‡å‡†å› å­

**æ–‡ä»¶**: `qlib_enhanced/chanlun/chanlun_factors.py` (é¢„è®¡200è¡Œ)

```python
from qlib.data.dataset.handler import DataHandlerLP
from qlib.data import D
from features.chanlun.czsc_features import CzscFeatureGenerator
from features.chanlun.chanpy_features import ChanPyFeatureGenerator

class ChanLunFactors:
    """ç¼ è®ºå› å­ - æ³¨å†Œåˆ°Qlibå› å­åº“
    
    å°†16ä¸ªç¼ è®ºç‰¹å¾æ³¨å†Œä¸ºQlibæ ‡å‡†å› å­:
    - $fx_mark: åˆ†å‹æ ‡è®°
    - $bi_direction: ç¬”æ–¹å‘
    - $is_buy_point: æ˜¯å¦ä¹°ç‚¹
    - ...
    """
    
    @staticmethod
    def register_all_factors():
        """æ³¨å†Œæ‰€æœ‰ç¼ è®ºå› å­åˆ°Qlib"""
        
        # CZSCå› å­ (6ä¸ª)
        factor_dict = {
            '$fx_mark': 'CzscFeatureGenerator().fx_mark',
            '$bi_direction': 'CzscFeatureGenerator().bi_direction',
            '$bi_position': 'CzscFeatureGenerator().bi_position',
            '$bi_power': 'CzscFeatureGenerator().bi_power',
            '$in_zs': 'CzscFeatureGenerator().in_zs',
            '$bars_since_fx': 'CzscFeatureGenerator().bars_since_fx',
            
            # Chan.pyå› å­ (10ä¸ª)
            '$is_buy_point': 'ChanPyFeatureGenerator().is_buy_point',
            '$is_sell_point': 'ChanPyFeatureGenerator().is_sell_point',
            '$bsp_type': 'ChanPyFeatureGenerator().bsp_type',
            '$bsp_is_buy': 'ChanPyFeatureGenerator().bsp_is_buy',
            '$seg_direction': 'ChanPyFeatureGenerator().seg_direction',
            '$is_seg_start': 'ChanPyFeatureGenerator().is_seg_start',
            '$is_seg_end': 'ChanPyFeatureGenerator().is_seg_end',
            '$in_chanpy_zs': 'ChanPyFeatureGenerator().in_chanpy_zs',
            '$zs_low_chanpy': 'ChanPyFeatureGenerator().zs_low_chanpy',
            '$zs_high_chanpy': 'ChanPyFeatureGenerator().zs_high_chanpy',
        }
        
        # æ³¨å†Œåˆ°Qlib
        for name, expr in factor_dict.items():
            D.register_factor(name, expr)
        
        print(f"âœ… å·²æ³¨å†Œ {len(factor_dict)} ä¸ªç¼ è®ºå› å­åˆ°Qlib")
```

**ä½¿ç”¨æ–¹å¼**:
```python
# åœ¨Qlibç­–ç•¥ä¸­ç›´æ¥ä½¿ç”¨ç¼ è®ºå› å­
from qlib.data import D

# è·å–ç¼ è®ºå› å­æ•°æ®
df = D.features(
    instruments='csi300',
    fields=[
        '$close',
        '$fx_mark',        # ç¼ è®ºå› å­
        '$bi_direction',   # ç¼ è®ºå› å­
        '$is_buy_point'    # ç¼ è®ºå› å­
    ],
    start_time='2020-01-01',
    end_time='2024-12-31'
)
```

#### ä»»åŠ¡1.2: ç¼ è®ºAlphaå› å­ç»„åˆ
**ç›®æ ‡**: åŸºäºç¼ è®ºç‰¹å¾æ„é€ å¤åˆAlphaå› å­

**æ–‡ä»¶**: `qlib_enhanced/chanlun/chanlun_alpha.py` (é¢„è®¡150è¡Œ)

```python
class ChanLunAlphaFactors:
    """ç¼ è®ºAlphaå› å­
    
    åŸºäº16ä¸ªåŸºç¡€ç¼ è®ºç‰¹å¾ï¼Œæ„é€ é«˜çº§Alphaå› å­
    """
    
    @staticmethod
    def register_alpha_factors():
        """æ³¨å†Œå¤åˆAlphaå› å­"""
        
        alpha_factors = {
            # Alpha1: ä¹°ç‚¹å¼ºåº¦ (ä¹°ç‚¹+ç¬”åŠ›åº¦)
            '$chanlun_alpha1': '($is_buy_point * $bi_power)',
            
            # Alpha2: å–ç‚¹é£é™© (å–ç‚¹-ç¬”åŠ›åº¦)
            '$chanlun_alpha2': '(-$is_sell_point * $bi_power)',
            
            # Alpha3: è¶‹åŠ¿ä¸€è‡´æ€§ (ç¬”æ–¹å‘*çº¿æ®µæ–¹å‘)
            '$chanlun_alpha3': '($bi_direction * $seg_direction)',
            
            # Alpha4: å½¢æ€çªç ´ (åˆ†å‹æ ‡è®°*ç¬”ä½ç½®)
            '$chanlun_alpha4': '($fx_mark * $bi_position)',
            
            # Alpha5: ä¸­æ¢éœ‡è¡ (åœ¨ä¸­æ¢å†…ä¸”æ¥è¿‘è¾¹ç•Œ)
            '$chanlun_alpha5': '($in_zs * (1 - Abs($close - ($zs_low_chanpy + $zs_high_chanpy) / 2) / ($zs_high_chanpy - $zs_low_chanpy)))',
            
            # Alpha6: ä¹°ç‚¹æŒç»­æ€§ (ä¹°ç‚¹å‡ºç°åçš„æŒç»­æ—¶é—´)
            '$chanlun_alpha6': '(Sum($is_buy_point, 5) / 5)',
            
            # Alpha7: å½¢æ€è½¬æŠ˜ (åˆ†å‹å˜åŒ–)
            '$chanlun_alpha7': '(Delta($fx_mark, 1))',
            
            # Alpha8: ç¬”æ®µå…±æŒ¯ (ç¬”æ–¹å‘ä¸5æ—¥å‡çº¿æ–¹å‘ä¸€è‡´)
            '$chanlun_alpha8': '($bi_direction * Sign(Mean($close, 5) - Mean($close, 10)))',
            
            # Alpha9: ä¹°å–ç‚¹æ¯”ç‡ (è¿‘æœŸä¹°ç‚¹/å–ç‚¹æ¯”)
            '$chanlun_alpha9': '(Sum($is_buy_point, 20) / (Sum($is_sell_point, 20) + 1))',
            
            # Alpha10: ç¼ è®ºåŠ¨é‡ (ç¬”åŠ›åº¦*æ–¹å‘çš„ç§»åŠ¨å¹³å‡)
            '$chanlun_alpha10': 'Mean($bi_power * $bi_direction, 5)',
        }
        
        for name, expr in alpha_factors.items():
            D.register_factor(name, expr)
        
        print(f"âœ… å·²æ³¨å†Œ {len(alpha_factors)} ä¸ªç¼ è®ºAlphaå› å­")
```

#### ä»»åŠ¡1.3: ä¸ç°æœ‰Qlibå›æµ‹é›†æˆ
**ç›®æ ‡**: ä½¿ç”¨éº’éºŸç°æœ‰Qlibå›æµ‹æ¡†æ¶æµ‹è¯•ç¼ è®ºç­–ç•¥

**é…ç½®æ–‡ä»¶**: `configs/chanlun/qlib_workflow_enhanced.yaml`

```yaml
qlib_init:
    provider_uri: "~/.qlib/qlib_data/cn_data"
    region: cn

market: csi300

data_handler_config: &data_handler_config
    start_time: 2020-01-01
    end_time: 2023-12-31
    fit_start_time: 2020-01-01
    fit_end_time: 2022-12-31
    instruments: csi300
    
    # ä½¿ç”¨æ··åˆHandler
    class: HybridChanLunHandler
    module_path: qlib_enhanced.chanlun.hybrid_handler
    kwargs:
        use_chanpy: true
        seg_algo: chan
        
    # æ•°æ®åˆ— (Qlibæ ‡å‡†æ ¼å¼ + ç¼ è®ºå› å­)
    infer_processors:
        - class: FilterCol
          kwargs:
              fields_group: feature
              col_list: 
                  # åŸºç¡€è¡Œæƒ…
                  - $close
                  - $open
                  - $high
                  - $low
                  - $volume
                  # ç¼ è®ºå› å­
                  - $fx_mark
                  - $bi_direction
                  - $is_buy_point
                  - $is_sell_point
                  # ç¼ è®ºAlpha
                  - $chanlun_alpha1
                  - $chanlun_alpha2
                  - $chanlun_alpha10

# æ¨¡å‹é…ç½® (å¤ç”¨éº’éºŸç°æœ‰LightGBM)
model:
    class: LGBModel
    module_path: qlib.contrib.model.gbdt
    kwargs:
        loss: mse
        colsample_bytree: 0.8
        learning_rate: 0.05
        subsample: 0.8
        lambda_l1: 205.6999
        lambda_l2: 580.9768
        max_depth: 8
        num_leaves: 210
        num_threads: 20

# ç­–ç•¥é…ç½® (å¤ç”¨éº’éºŸTopKç­–ç•¥)
strategy:
    class: TopkDropoutStrategy
    module_path: qlib.contrib.strategy.signal_strategy
    kwargs:
        signal:
            - <MODEL>
            - <DATASET>
        topk: 30
        n_drop: 5

# å›æµ‹é…ç½® (å¤ç”¨éº’éºŸExecutor)
backtest:
    start_time: 2022-01-01
    end_time: 2023-12-31
    account: 100000000
    benchmark: SH000300
    exchange_kwargs:
        freq: day
        limit_threshold: 0.095
        deal_price: close
        open_cost: 0.0005
        close_cost: 0.0015
        min_cost: 5
```

**è¿è¡Œå›æµ‹**:
```bash
# ä½¿ç”¨éº’éºŸç°æœ‰Qlibå‘½ä»¤
qlib_run run --config_path configs/chanlun/qlib_workflow_enhanced.yaml
```

---

### Month 2: èåˆåˆ°éº’éºŸMLæ¨¡å‹ (10äººå¤©)

#### ä»»åŠ¡2.1: ç¼ è®ºç‰¹å¾ä½œä¸ºMLæ¨¡å‹è¾“å…¥
**ç›®æ ‡**: å°†16ä¸ªç¼ è®ºç‰¹å¾è¾“å…¥éº’éºŸç°æœ‰LightGBMæ¨¡å‹

**æ–‡ä»¶**: `ml/chanlun_lgb_model.py` (é¢„è®¡150è¡Œ)

```python
from qlib.contrib.model.gbdt import LGBModel
from qlib.data import D

class ChanLunEnhancedLGBModel(LGBModel):
    """ç¼ è®ºå¢å¼ºçš„LightGBMæ¨¡å‹
    
    åœ¨éº’éºŸç°æœ‰LGBModelåŸºç¡€ä¸Šï¼Œå¢åŠ ç¼ è®ºç‰¹å¾
    """
    
    def __init__(self, **kwargs):
        # ç»§æ‰¿éº’éºŸç°æœ‰LGBModelé…ç½®
        super().__init__(**kwargs)
        
        # æ³¨å†Œç¼ è®ºå› å­
        from qlib_enhanced.chanlun.chanlun_factors import ChanLunFactors
        ChanLunFactors.register_all_factors()
        
    def get_feature_config(self):
        """è·å–ç‰¹å¾é…ç½® (åŸæœ‰ç‰¹å¾ + ç¼ è®ºç‰¹å¾)"""
        
        # éº’éºŸåŸæœ‰ç‰¹å¾ (å‡è®¾å·²æœ‰Alpha191ç­‰)
        base_features = super().get_feature_config()
        
        # ç¼ è®ºç‰¹å¾
        chanlun_features = [
            '$fx_mark',
            '$bi_direction',
            '$bi_power',
            '$is_buy_point',
            '$is_sell_point',
            '$chanlun_alpha1',
            '$chanlun_alpha2',
            '$chanlun_alpha10',
        ]
        
        # åˆå¹¶
        return base_features + chanlun_features
```

**é…ç½®ç¤ºä¾‹**:
```yaml
# configs/chanlun/ml_fusion_config.yaml
model:
    class: ChanLunEnhancedLGBModel
    module_path: ml.chanlun_lgb_model
    kwargs:
        loss: mse
        num_boost_round: 500
        # éº’éºŸåŸæœ‰å‚æ•°...
```

#### ä»»åŠ¡2.2: ç¼ è®ºç‰¹å¾é‡è¦æ€§åˆ†æ
**ç›®æ ‡**: åˆ†æç¼ è®ºç‰¹å¾åœ¨MLæ¨¡å‹ä¸­çš„è´¡çŒ®åº¦

**æ–‡ä»¶**: `analysis/chanlun_feature_importance.py` (é¢„è®¡100è¡Œ)

```python
import pandas as pd
import matplotlib.pyplot as plt

class ChanLunFeatureAnalysis:
    """ç¼ è®ºç‰¹å¾é‡è¦æ€§åˆ†æ"""
    
    def __init__(self, model):
        self.model = model
    
    def analyze_feature_importance(self):
        """åˆ†æç‰¹å¾é‡è¦æ€§"""
        
        # è·å–LightGBMç‰¹å¾é‡è¦æ€§
        importance = self.model.get_feature_importance()
        
        # ç­›é€‰ç¼ è®ºç‰¹å¾
        chanlun_importance = importance[
            importance['feature'].str.contains('chanlun|fx_mark|bi_|bsp')
        ]
        
        # å¯è§†åŒ–
        self.plot_importance(chanlun_importance)
        
        # ç”ŸæˆæŠ¥å‘Š
        report = self.generate_report(chanlun_importance)
        
        return report
    
    def plot_importance(self, importance_df):
        """ç»˜åˆ¶ç‰¹å¾é‡è¦æ€§å›¾"""
        plt.figure(figsize=(10, 6))
        plt.barh(importance_df['feature'], importance_df['importance'])
        plt.xlabel('Importance')
        plt.title('ç¼ è®ºç‰¹å¾é‡è¦æ€§')
        plt.tight_layout()
        plt.savefig('output/chanlun_feature_importance.png')
    
    def generate_report(self, importance_df):
        """ç”Ÿæˆåˆ†ææŠ¥å‘Š"""
        report = {
            'total_features': len(importance_df),
            'top_5_features': importance_df.head(5).to_dict('records'),
            'total_contribution': importance_df['importance'].sum(),
            'avg_importance': importance_df['importance'].mean()
        }
        return report
```

#### ä»»åŠ¡2.3: ç¼ è®º+ä¼ ç»Ÿå› å­èåˆç­–ç•¥
**ç›®æ ‡**: å°†ç¼ è®ºå› å­ä¸éº’éºŸç°æœ‰å› å­ï¼ˆAlpha191/æŠ€æœ¯æŒ‡æ ‡ï¼‰èåˆ

**ç­–ç•¥é…ç½®**:
```yaml
# configs/chanlun/fusion_strategy.yaml
strategy:
    class: WeightedEnsembleStrategy
    module_path: strategies.ensemble_strategy
    kwargs:
        models:
            # æ¨¡å‹1: ä¼ ç»ŸAlpha191å› å­
            - name: alpha191_model
              weight: 0.40
              features:
                  - alpha_001
                  - alpha_002
                  # ... alpha_191
            
            # æ¨¡å‹2: ç¼ è®ºå› å­
            - name: chanlun_model
              weight: 0.35
              features:
                  - $fx_mark
                  - $bi_direction
                  - $is_buy_point
                  # ... ç¼ è®ºå› å­
            
            # æ¨¡å‹3: æŠ€æœ¯æŒ‡æ ‡
            - name: technical_model
              weight: 0.25
              features:
                  - $macd
                  - $rsi
                  - $kdj
        
        # èåˆæ–¹å¼
        ensemble_method: weighted_average
        rebalance_freq: daily
```

---

### Month 3: æ€§èƒ½ä¼˜åŒ–ä¸æ•°æ®å¢å¼º (10äººå¤©)

#### ä»»åŠ¡3.1: ç¼“å­˜ä¼˜åŒ–ï¼ˆåˆ©ç”¨éº’éºŸç¼“å­˜æœºåˆ¶ï¼‰
**ç›®æ ‡**: ä½¿ç”¨éº’éºŸç°æœ‰Redis/æœ¬åœ°ç¼“å­˜ç³»ç»Ÿ

**æ–‡ä»¶**: `utils/chanlun_cache.py` (é¢„è®¡80è¡Œ)

```python
from qlib.utils.cache import H  # éº’éºŸQlibç¼“å­˜ç³»ç»Ÿ

class ChanLunCache:
    """ç¼ è®ºç‰¹å¾ç¼“å­˜ï¼ˆå¤ç”¨éº’éºŸç¼“å­˜ï¼‰"""
    
    def __init__(self):
        # ä½¿ç”¨Qlibå†…ç½®ç¼“å­˜
        self.cache = H['chanlun_features']
    
    def get_cached_features(self, code, date):
        """è·å–ç¼“å­˜çš„ç‰¹å¾"""
        cache_key = f"{code}_{date}"
        return self.cache.get(cache_key)
    
    def set_cached_features(self, code, date, features):
        """è®¾ç½®ç¼“å­˜"""
        cache_key = f"{code}_{date}"
        self.cache[cache_key] = features
        
    def clear_expired_cache(self, days=30):
        """æ¸…ç†è¿‡æœŸç¼“å­˜ï¼ˆåˆ©ç”¨Qlibç¼“å­˜è¿‡æœŸæœºåˆ¶ï¼‰"""
        # Qlibè‡ªåŠ¨ç®¡ç†ç¼“å­˜è¿‡æœŸ
        pass
```

#### ä»»åŠ¡3.2: å¹¶è¡Œè®¡ç®—ï¼ˆåˆ©ç”¨Qlibå¹¶è¡Œæ¡†æ¶ï¼‰
**ç›®æ ‡**: ä½¿ç”¨Qlibå†…ç½®çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›

```python
from qlib.workflow import R
from qlib.utils import init_instance_by_config

# Qlibè‡ªåŠ¨å¹¶è¡Œå¤„ç†
# åœ¨é…ç½®ä¸­æŒ‡å®šå¹¶è¡Œå‚æ•°
config = {
    'task': {
        'model': {...},
        'dataset': {...},
        'record': {
            'class': 'SignalRecord',
            'kwargs': {
                'num_workers': 8,  # Qlibè‡ªåŠ¨å¹¶è¡Œ
            }
        }
    }
}
```

#### ä»»åŠ¡3.3: æ•°æ®æ¥å…¥ï¼ˆå¤ç”¨éº’éºŸæ•°æ®æºï¼‰
**ç›®æ ‡**: ä½¿ç”¨éº’éºŸå·²æ¥å…¥çš„æ•°æ®æº

```python
# æ— éœ€é‡æ–°å¼€å‘æ•°æ®æ¥å£ï¼Œç›´æ¥ä½¿ç”¨éº’éºŸç°æœ‰æ•°æ®
from qlib.data import D

# éº’éºŸå·²æ¥å…¥çš„æ•°æ®æº
df = D.features(
    instruments='csi300',
    fields=['$close', '$volume'],  # ç›´æ¥ä½¿ç”¨
    start_time='2020-01-01'
)

# åœ¨æ­¤åŸºç¡€ä¸Šç”Ÿæˆç¼ è®ºç‰¹å¾
from features.chanlun.czsc_features import CzscFeatureGenerator
generator = CzscFeatureGenerator()
chanlun_features = generator.generate_features(df)
```

---

## ğŸš€ é˜¶æ®µäºŒ: ç­–ç•¥å¢å¼ºä¸å®ç›˜å¯¹æ¥ (4-6æœˆ)

**ç›®æ ‡**: å¢å¼ºç­–ç•¥èƒ½åŠ›ï¼Œå¯¹æ¥éº’éºŸå®ç›˜ç³»ç»Ÿ  
**ç‰ˆæœ¬**: v1.3 â†’ v1.5  
**å·¥ä½œé‡**: çº¦25äººå¤©

### Month 4: å¤šçº§åˆ«ç¼ è®ºç­–ç•¥ (10äººå¤©)

#### ä»»åŠ¡4.1: å¤šå‘¨æœŸå› å­æ³¨å†Œ
**ç›®æ ‡**: æ³¨å†Œå¤šå‘¨æœŸç¼ è®ºå› å­åˆ°Qlib

```python
# æ³¨å†Œä¸åŒå‘¨æœŸçš„ç¼ è®ºå› å­
factor_dict = {
    # æ—¥çº¿å‘¨æœŸ
    '$fx_mark_1d': 'CzscFeatureGenerator(freq="1d").fx_mark',
    '$bi_direction_1d': 'CzscFeatureGenerator(freq="1d").bi_direction',
    
    # 60åˆ†é’Ÿå‘¨æœŸ
    '$fx_mark_60min': 'CzscFeatureGenerator(freq="60min").fx_mark',
    '$bi_direction_60min': 'CzscFeatureGenerator(freq="60min").bi_direction',
    
    # 30åˆ†é’Ÿå‘¨æœŸ
    '$fx_mark_30min': 'CzscFeatureGenerator(freq="30min").fx_mark',
    '$bi_direction_30min': 'CzscFeatureGenerator(freq="30min").bi_direction',
}

# å¤šå‘¨æœŸå…±æŒ¯å› å­
resonance_factors = {
    # å…±æŒ¯1: å¤šå‘¨æœŸåŒå‘
    '$multi_level_resonance': '($bi_direction_1d == $bi_direction_60min) & ($bi_direction_60min == $bi_direction_30min)',
    
    # å…±æŒ¯2: å¤šå‘¨æœŸä¹°ç‚¹ç¡®è®¤
    '$multi_level_buy': '($is_buy_point_1d | $is_buy_point_60min | $is_buy_point_30min)',
}
```

#### ä»»åŠ¡4.2: ä¸€è¿›äºŒæ¶¨åœç­–ç•¥é›†æˆ
**ç›®æ ‡**: å°†æ¶¨åœç­–ç•¥é›†æˆåˆ°Qlibå›æµ‹

```yaml
# configs/chanlun/limitup_strategy.yaml
strategy:
    class: LimitUpChanLunStrategy
    module_path: strategies.limitup_strategy
    kwargs:
        # æ¶¨åœç­›é€‰
        limitup_filter:
            min_limitup_days: 1
            max_limitup_days: 3
        
        # ç¼ è®ºè¯„åˆ†
        chanlun_score_threshold: 70
        
        # æ¿å—æ•ˆåº”
        sector_linkage: true
        min_sector_count: 3
        
        # èµ„é‡‘ç®¡ç†
        position_pct: 0.1  # å•è‚¡10%ä»“ä½
        max_positions: 5   # æœ€å¤š5åª
```

---

### Month 5-6: å®ç›˜å¯¹æ¥ä¸Webé›†æˆ (15äººå¤©)

#### ä»»åŠ¡5.1: å®ç›˜äº¤æ˜“é›†æˆï¼ˆå¤ç”¨éº’éºŸäº¤æ˜“ç³»ç»Ÿï¼‰
**ç›®æ ‡**: å°†ç¼ è®ºç­–ç•¥æ¥å…¥éº’éºŸç°æœ‰å®ç›˜äº¤æ˜“ç³»ç»Ÿ

```python
# æ— éœ€é‡æ–°å¼€å‘äº¤æ˜“æ¥å£
# ç›´æ¥ä½¿ç”¨éº’éºŸç°æœ‰äº¤æ˜“ç³»ç»Ÿ

from qilin_trading import TradingExecutor  # éº’éºŸäº¤æ˜“æ‰§è¡Œå™¨

class ChanLunTrading:
    """ç¼ è®ºå®ç›˜äº¤æ˜“"""
    
    def __init__(self):
        # ä½¿ç”¨éº’éºŸç°æœ‰äº¤æ˜“æ‰§è¡Œå™¨
        self.executor = TradingExecutor()
        self.selector = MultiAgentStockSelector()
    
    def execute_daily_signals(self):
        """æ‰§è¡Œæ¯æ—¥ä¿¡å·"""
        # 1. è·å–æœ€æ–°æ•°æ®ï¼ˆéº’éºŸæ•°æ®æºï¼‰
        data = self.get_latest_data()
        
        # 2. ç¼ è®ºè¯„åˆ†
        results = self.selector.batch_score(data, top_n=10)
        
        # 3. ç”Ÿæˆäº¤æ˜“ä¿¡å·
        signals = self.generate_signals(results)
        
        # 4. æ‰§è¡Œäº¤æ˜“ï¼ˆéº’éºŸäº¤æ˜“ç³»ç»Ÿï¼‰
        self.executor.execute(signals)
```

#### ä»»åŠ¡5.2: Webç•Œé¢é›†æˆï¼ˆå¤ç”¨éº’éºŸWebç³»ç»Ÿï¼‰
**ç›®æ ‡**: åœ¨éº’éºŸWebç•Œé¢æ·»åŠ ç¼ è®ºæ¨¡å—

**åç«¯API**:
```python
# web/backend/api/chanlun_api.py
from flask import Blueprint
from qlib.data import D

chanlun_bp = Blueprint('chanlun', __name__)

@chanlun_bp.route('/score/<code>')
def get_score(code):
    """è·å–ç¼ è®ºè¯„åˆ†ï¼ˆä½¿ç”¨Qlibæ•°æ®ï¼‰"""
    # 1. ä»Qlibè·å–æ•°æ®
    df = D.features(
        instruments=code,
        fields=['$close', '$fx_mark', '$is_buy_point']
    )
    
    # 2. è®¡ç®—è¯„åˆ†
    score = calculate_chanlun_score(df)
    
    return {'code': code, 'score': score}
```

**å‰ç«¯ç»„ä»¶**ï¼ˆé›†æˆåˆ°éº’éºŸç°æœ‰Vueç•Œé¢ï¼‰:
```vue
<!-- åœ¨éº’éºŸç°æœ‰é¡µé¢ä¸­æ·»åŠ ç¼ è®ºç»„ä»¶ -->
<template>
  <div class="strategy-page">
    <!-- éº’éºŸåŸæœ‰ç»„ä»¶ -->
    <ExistingComponent />
    
    <!-- æ–°å¢: ç¼ è®ºæ¨¡å— -->
    <ChanLunScoreCard :code="currentStock" />
    <ChanLunAnalysis :code="currentStock" />
  </div>
</template>
```

#### ä»»åŠ¡5.3: ç›‘æ§å‘Šè­¦ï¼ˆå¤ç”¨éº’éºŸç›‘æ§ç³»ç»Ÿï¼‰
**ç›®æ ‡**: ä½¿ç”¨éº’éºŸç°æœ‰ç›‘æ§å‘Šè­¦ç³»ç»Ÿ

```python
from qilin_monitor import AlertManager  # éº’éºŸç›‘æ§ç³»ç»Ÿ

# æ— éœ€é‡æ–°å¼€å‘ç›‘æ§ç³»ç»Ÿ
alert_manager = AlertManager()

# ç¼ è®ºä¿¡å·å‘Šè­¦
if chanlun_score > 85:
    alert_manager.send_alert(
        level='high',
        title='ç¼ è®ºå¼ºçƒˆä¹°å…¥ä¿¡å·',
        content=f'{code} ç¼ è®ºè¯„åˆ†{chanlun_score}',
        channels=['wechat', 'email']  # ä½¿ç”¨éº’éºŸå·²é…ç½®çš„é€šçŸ¥æ¸ é“
    )
```

---

## ğŸ“Š å‡çº§è®¡åˆ’æ€»è§ˆ

### æ—¶é—´çº¿
| é˜¶æ®µ | å‘¨æœŸ | ä»»åŠ¡ | å·¥ä½œé‡ | ç‰ˆæœ¬ |
|------|------|------|--------|------|
| é˜¶æ®µä¸€ | 1-3æœˆ | æ·±åº¦é›†æˆä¼˜åŒ– | 30äººå¤© | v1.0â†’v1.3 |
| é˜¶æ®µäºŒ | 4-6æœˆ | ç­–ç•¥å¢å¼º+å®ç›˜ | 25äººå¤© | v1.3â†’v1.5 |
| **æ€»è®¡** | **6æœˆ** | **11ä»»åŠ¡** | **55äººå¤©** | **v1.5** |

### é›†æˆæ–¹æ¡ˆå¯¹æ¯”

| åŠŸèƒ½ | åŸè®¡åˆ’ï¼ˆé‡å¤å¼€å‘ï¼‰ | æ–°è®¡åˆ’ï¼ˆå¤ç”¨é›†æˆï¼‰ | èŠ‚çœ |
|------|-------------------|-------------------|------|
| Qlibå›æµ‹ | é‡æ–°å®ç°300è¡Œ | é…ç½®æ–‡ä»¶50è¡Œ | 250è¡Œ |
| LightGBM | é‡æ–°è®­ç»ƒ200è¡Œ | ç»§æ‰¿æ‰©å±•100è¡Œ | 100è¡Œ |
| æ•°æ®æ¥å£ | Tushare 200è¡Œ | å¤ç”¨Qlib 0è¡Œ | 200è¡Œ |
| äº¤æ˜“ç³»ç»Ÿ | é‡æ–°å¼€å‘300è¡Œ | å¤ç”¨éº’éºŸ 50è¡Œ | 250è¡Œ |
| Webç•Œé¢ | ç‹¬ç«‹å¼€å‘2000è¡Œ | ç»„ä»¶é›†æˆ400è¡Œ | 1600è¡Œ |
| ç›‘æ§å‘Šè­¦ | é‡æ–°å®ç°150è¡Œ | å¤ç”¨éº’éºŸ 30è¡Œ | 120è¡Œ |
| **æ€»è®¡** | **3150è¡Œ** | **630è¡Œ** | **2520è¡Œ** |

**å¼€å‘æ•ˆç‡æå‡**: **80%** âœ¨

---

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

### 1. æ— ç¼é›†æˆ
- âœ… ç¼ è®ºå› å­ç›´æ¥æ³¨å†Œåˆ°Qlibå› å­åº“
- âœ… ä½¿ç”¨Qlibæ ‡å‡†æ ¼å¼ï¼Œä¸ç°æœ‰å› å­å®Œå…¨å…¼å®¹
- âœ… å¤ç”¨éº’éºŸæ‰€æœ‰åŸºç¡€è®¾æ–½ï¼ˆæ•°æ®/æ¨¡å‹/äº¤æ˜“/ç›‘æ§ï¼‰

### 2. æ¸è¿›å¼å‡çº§
- âœ… ä¸å½±å“éº’éºŸç°æœ‰åŠŸèƒ½
- âœ… å¯ä»¥é€æ­¥å¯ç”¨ç¼ è®ºå› å­
- âœ… çµæ´»è°ƒæ•´ç¼ è®ºæƒé‡

### 3. ååŒå¢å¼º
```
éº’éºŸåŸæœ‰èƒ½åŠ› + ç¼ è®ºå¢å¼º = æ›´å¼ºå¤§çš„ç³»ç»Ÿ
- Alpha191å› å­ + ç¼ è®ºå› å­ = æ›´å…¨é¢çš„ç‰¹å¾
- LightGBMæ¨¡å‹ + ç¼ è®ºç‰¹å¾ = æ›´å‡†ç¡®çš„é¢„æµ‹
- TopKç­–ç•¥ + ç¼ è®ºè¯„åˆ† = æ›´ç²¾å‡†çš„é€‰è‚¡
```

---

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### æ€§èƒ½æå‡
| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ | æå‡ |
|------|------|------|------|
| IC | 0.05 | 0.08 | +60% |
| å¹´åŒ–æ”¶ç›Š | 15% | 25% | +67% |
| å¤æ™®æ¯”ç‡ | 1.2 | 1.8 | +50% |
| æœ€å¤§å›æ’¤ | 20% | 15% | -25% |

### å¼€å‘æ•ˆç‡
- ä»£ç å¤ç”¨ç‡: **80%**
- å¼€å‘å‘¨æœŸ: **6ä¸ªæœˆ**ï¼ˆvs 12ä¸ªæœˆï¼‰
- å·¥ä½œé‡: **55äººå¤©**ï¼ˆvs 180äººå¤©ï¼‰

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### Step 1: æ³¨å†Œç¼ è®ºå› å­
```python
from qlib_enhanced.chanlun.chanlun_factors import ChanLunFactors

# æ³¨å†Œæ‰€æœ‰ç¼ è®ºå› å­åˆ°Qlib
ChanLunFactors.register_all_factors()
```

### Step 2: åœ¨ç­–ç•¥ä¸­ä½¿ç”¨
```yaml
# configs/my_strategy.yaml
data_handler_config:
    fields_group: feature
    col_list:
        - $close
        - $fx_mark        # ç¼ è®ºå› å­
        - $is_buy_point   # ç¼ è®ºå› å­
```

### Step 3: è¿è¡Œå›æµ‹
```bash
# ä½¿ç”¨éº’éºŸç°æœ‰å‘½ä»¤
qlib_run run --config_path configs/my_strategy.yaml
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å› å­æƒé‡é…ç½®
```yaml
# æ¨èé…ç½®
model_weight:
    alpha191: 0.40      # ä¼ ç»Ÿå› å­
    chanlun: 0.35       # ç¼ è®ºå› å­
    technical: 0.25     # æŠ€æœ¯æŒ‡æ ‡
```

### 2. ç‰¹å¾é€‰æ‹©
```python
# é€‰æ‹©é‡è¦çš„ç¼ è®ºç‰¹å¾
important_chanlun_features = [
    '$is_buy_point',      # ä¹°ç‚¹ä¿¡å·
    '$bi_direction',      # è¶‹åŠ¿æ–¹å‘
    '$chanlun_alpha1',    # ä¹°ç‚¹å¼ºåº¦
    '$chanlun_alpha10'    # ç¼ è®ºåŠ¨é‡
]
```

### 3. å›æµ‹éªŒè¯
```python
# é€æ­¥éªŒè¯
# 1. å…ˆå•ç‹¬æµ‹è¯•ç¼ è®ºå› å­æ•ˆæœ
# 2. å†ä¸åŸæœ‰å› å­å¯¹æ¯”
# 3. æœ€åèåˆä½¿ç”¨
```

---

## ğŸ‰ æ€»ç»“

è¿™ä»½å‡çº§è®¡åˆ’åŸºäº**éº’éºŸç³»ç»Ÿç°æœ‰æ¶æ„**ï¼Œé€šè¿‡**æ·±åº¦é›†æˆè€Œéé‡å¤å¼€å‘**ï¼š

âœ… **å¤ç”¨Qlibæ¡†æ¶** - å› å­æ³¨å†Œã€å›æµ‹ã€æ‰§è¡Œ  
âœ… **å¤ç”¨MLåŸºç¡€è®¾æ–½** - LightGBMæ¨¡å‹æ‰©å±•  
âœ… **å¤ç”¨æ•°æ®ç³»ç»Ÿ** - Qlibæ•°æ®æº  
âœ… **å¤ç”¨äº¤æ˜“ç³»ç»Ÿ** - å®ç›˜æ‰§è¡Œå™¨  
âœ… **å¤ç”¨Webç³»ç»Ÿ** - ç»„ä»¶åŒ–é›†æˆ  

**å¼€å‘æ•ˆç‡æå‡80%ï¼Œ6ä¸ªæœˆå®Œæˆv1.5ç‰ˆæœ¬ï¼**

---

**ç‰ˆæœ¬**: v2.0  
**åˆ¶å®šæ—¥æœŸ**: 2025-01  
**åˆ¶å®šäºº**: Warp AI Assistant  
**é¡¹ç›®**: éº’éºŸé‡åŒ–ç³»ç»Ÿ - ç¼ è®ºæ¨¡å—å‡çº§è®¡åˆ’ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
